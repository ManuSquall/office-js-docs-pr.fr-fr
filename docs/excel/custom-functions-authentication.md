---
ms.date: 1/29/2019
description: Authentifier les utilisateurs à l’aide des fonctions personnalisées dans Excel.
title: Authentification pour les fonctions personnalisées
ms.openlocfilehash: 0e42dbc93cb545660a8dbaae5bdb48724f3b7376
ms.sourcegitcommit: 33dcf099c6b3d249811580d67ee9b790c0fdccfb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2019
ms.locfileid: "29745408"
---
# <a name="authentication"></a><span data-ttu-id="f30f8-103">Authentification</span><span class="sxs-lookup"><span data-stu-id="f30f8-103">Authentication</span></span>

<span data-ttu-id="f30f8-104">Dans certains scénarios, à que votre fonction personnalisée a besoin d’authentifier l’utilisateur pour accéder des ressources protégées.</span><span class="sxs-lookup"><span data-stu-id="f30f8-104">In some scenarios your custom function will need to authenticate the user in order to access protected resources.</span></span> <span data-ttu-id="f30f8-105">Alors que les fonctions personnalisées ne nécessite pas une méthode d’authentification spécifique, sachez que les fonctions personnalisées s’exécute dans une exécution distincte dans le volet de tâches et d’autres éléments de l’interface utilisateur de votre complément.</span><span class="sxs-lookup"><span data-stu-id="f30f8-105">While custom functions doesn't require a specific method of authentication, you should be aware that custom functions runs in a separate runtime from the task pane and other UI elements of your add-in.</span></span> <span data-ttu-id="f30f8-106">Pour cette raison, vous devez passer des données aller-retour entre les deux runtimes à l’aide de la `AsyncStorage` objet et l’API de boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="f30f8-106">Because of this, you'll need to pass data back and forth between the two runtimes using the `AsyncStorage` object and the Dialog API.</span></span>
  
## <a name="asyncstorage-object"></a><span data-ttu-id="f30f8-107">Objet AsyncStorage</span><span class="sxs-lookup"><span data-stu-id="f30f8-107">AsyncStorage object</span></span>

<span data-ttu-id="f30f8-108">Le module d’exécution des fonctions personnalisées ne possède pas une `localStorage` objet disponible dans la fenêtre globale, où vous pouvez généralement stocker des données.</span><span class="sxs-lookup"><span data-stu-id="f30f8-108">The custom functions runtime doesn't have a `localStorage` object available on the global window, where you might typically store data.</span></span> <span data-ttu-id="f30f8-109">Au lieu de cela, vous devez partager des données entre des fonctions personnalisées et des volets de tâches, à l’aide de [OfficeRuntime.AsyncStorage](https://docs.microsoft.com/javascript/api/office-runtime/officeruntime.asyncstorage) pour définir et obtenir des données.</span><span class="sxs-lookup"><span data-stu-id="f30f8-109">Instead, you should share data between custom functions and task panes, by using [OfficeRuntime.AsyncStorage](https://docs.microsoft.com/javascript/api/office-runtime/officeruntime.asyncstorage) to set and get data.</span></span> 

<span data-ttu-id="f30f8-110">En outre, il est un avantage à l’aide de `AsyncStorage`; Il utilise un environnement de bac à sable sécurisé afin que vos données ne sont pas accessibles par les autres compléments.</span><span class="sxs-lookup"><span data-stu-id="f30f8-110">Additionally, there is a benefit to using `AsyncStorage`; it uses a secure sandbox environment so that your data cannot be accessed by other add-ins.</span></span>  

### <a name="suggested-usage"></a><span data-ttu-id="f30f8-111">Utilisation suggérée</span><span class="sxs-lookup"><span data-stu-id="f30f8-111">Suggested usage</span></span>

<span data-ttu-id="f30f8-112">Lorsque vous avez besoin authentifier à partir du volet Office ou une fonction personnalisée, vérifiez AsyncStorage pour voir si le jeton d’accès a été déjà acquises.</span><span class="sxs-lookup"><span data-stu-id="f30f8-112">When you need to authenticate either from the task pane or a custom function, check AsyncStorage to see if the access token was already acquired.</span></span> <span data-ttu-id="f30f8-113">Si ce n’est pas le cas, utilisez la boîte de dialogue API pour authentifier l’utilisateur, extraire le jeton d’accès, puis enregistrez le jeton dans AsyncStorage pour une utilisation future.</span><span class="sxs-lookup"><span data-stu-id="f30f8-113">If not, use the dialog API to authenticate the user, retrieve the access token, and then store the token in AsyncStorage for future use.</span></span>

## <a name="dialog-api"></a><span data-ttu-id="f30f8-114">API de boîte de dialogue</span><span class="sxs-lookup"><span data-stu-id="f30f8-114">Dialog API</span></span>

<span data-ttu-id="f30f8-115">Si un jeton n’existe pas, vous devez utiliser l’API de boîte de dialogue pour demander à l’utilisateur de se connecter.</span><span class="sxs-lookup"><span data-stu-id="f30f8-115">If a token doesn't exist, you should use the Dialog API to ask the user to sign in.</span></span> <span data-ttu-id="f30f8-116">Lorsqu’un utilisateur entre ses informations d’identification, le jeton d’accès qui en résulte peut être stocké dans `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="f30f8-116">After a user enters their credentials, the resulting access token can be stored in `AsyncStorage`.</span></span>

> [!NOTE]
> <span data-ttu-id="f30f8-117">Le runtime de fonctions personnalisées utilise un objet Dialog est légèrement différent de l’objet Dialog dans le module d’exécution utilisé par les volets de tâches.</span><span class="sxs-lookup"><span data-stu-id="f30f8-117">The custom functions runtime uses a Dialog object that is slightly different from the Dialog object in the runtime used by task panes.</span></span> <span data-ttu-id="f30f8-118">Ils sont tous deux appelés « L’API de boîte de dialogue », mais utilisez `Officeruntime.Dialog` pour authentifier les utilisateurs dans le module d’exécution des fonctions personnalisées.</span><span class="sxs-lookup"><span data-stu-id="f30f8-118">They're both referred to as the "Dialog API", but use `Officeruntime.Dialog` to authenticate users in the custom functions runtime.</span></span>

<span data-ttu-id="f30f8-119">Pour plus d’informations sur l’utilisation de la `OfficeRuntime.Dialog`, voir [exécution des fonctions personnalisées](https://docs.microsoft.com/en-us/office/dev/add-ins/excel/custom-functions-runtime?view=office-js#displaying-a-dialog-box).</span><span class="sxs-lookup"><span data-stu-id="f30f8-119">For information on how to use the `OfficeRuntime.Dialog`, see [Custom Functions runtime](https://docs.microsoft.com/en-us/office/dev/add-ins/excel/custom-functions-runtime?view=office-js#displaying-a-dialog-box).</span></span>

<span data-ttu-id="f30f8-120">Lors de la prévision de l’ensemble du processus d’authentification, il peut être utile de considérer le volet de tâches et les éléments d’interface utilisateur de votre complément et personnalisé fonctionne portions de votre complément en tant qu’entités distinctes qui peuvent communiquer les uns avec les autres via `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="f30f8-120">When envisioning the entire authentication process as a whole, it might be helpful to think of the task pane and UI elements of your add-in and the custom functions portions of your add-in as separate entities which can communicate with each other through `AsyncStorage`.</span></span>

<span data-ttu-id="f30f8-121">Le diagramme suivant présente le processus de base.</span><span class="sxs-lookup"><span data-stu-id="f30f8-121">The following diagram outlines this basic process.</span></span> <span data-ttu-id="f30f8-122">Notez que la ligne en pointillés indique que tout en exécutant des actions distinctes, des fonctions personnalisées et du volet de tâches de votre complément sont les deux composants de votre complément dans sa globalité.</span><span class="sxs-lookup"><span data-stu-id="f30f8-122">Note that the dotted line indicates that while they perform separate actions, custom functions and your add-in's task pane are both parts of your add-in as a whole.</span></span>

1. <span data-ttu-id="f30f8-123">Vous émettez un appel de fonction personnalisée à partir d’une cellule dans un classeur Excel.</span><span class="sxs-lookup"><span data-stu-id="f30f8-123">You issue a custom function call from a cell in an Excel workbook.</span></span>
2. <span data-ttu-id="f30f8-124">Utilise la fonction personnalisée `Officeruntime.Dialog` à transmettre vos informations d’identification de l’utilisateur à un site Web.</span><span class="sxs-lookup"><span data-stu-id="f30f8-124">The custom function uses `Officeruntime.Dialog` to pass your user credentials to a website.</span></span>
3. <span data-ttu-id="f30f8-125">Ce site Web puis renvoie un jeton d’accès à la fonction personnalisée.</span><span class="sxs-lookup"><span data-stu-id="f30f8-125">This website then returns an access token to the custom function.</span></span>
4. <span data-ttu-id="f30f8-126">Votre fonction personnalisée définit ensuite ce jeton d’accès la `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="f30f8-126">Your custom function then sets this access token to the `AsyncStorage`.</span></span>
5. <span data-ttu-id="f30f8-127">Volet de tâches de votre complément accède au jeton de `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="f30f8-127">Your add-in's task pane accesses the token from `AsyncStorage`.</span></span>

<span data-ttu-id="f30f8-128">![Diagramme des fonctions personnalisées, OfficeRuntime et volets collaborer.] (../images/Authdiagram.png "Diagramme d’authentification.")</span><span class="sxs-lookup"><span data-stu-id="f30f8-128">![Diagram of custom functions, OfficeRuntime, and task panes working together.](../images/Authdiagram.png "Authentication diagram.")</span></span>

## <a name="general-guidance"></a><span data-ttu-id="f30f8-129">Conseils d’ordre général</span><span class="sxs-lookup"><span data-stu-id="f30f8-129">General guidance</span></span>

<span data-ttu-id="f30f8-130">Compléments Office sont basés sur le web et vous pouvez utiliser les techniques d’authentification web.</span><span class="sxs-lookup"><span data-stu-id="f30f8-130">Office Add-ins are web-based and you can use any web authentication technique.</span></span> <span data-ttu-id="f30f8-131">Il n’existe aucun modèle particulier ou une méthode à suivre pour implémenter votre propre authentification avec des fonctions personnalisées.</span><span class="sxs-lookup"><span data-stu-id="f30f8-131">There is no particular pattern or method you must follow to implement your own authentication with custom functions.</span></span> <span data-ttu-id="f30f8-132">Vous pouvez souhaiter, consultez la documentation sur les différents modèles d’authentification, en commençant par [cet article sur l’autorisation par le biais des services externes](https://docs.microsoft.com/en-us/office/dev/add-ins/develop/auth-external-add-ins?view=office-js).</span><span class="sxs-lookup"><span data-stu-id="f30f8-132">You may wish to consult the documentation about various authentication patterns, starting with [this article about authorizing via external services](https://docs.microsoft.com/en-us/office/dev/add-ins/develop/auth-external-add-ins?view=office-js).</span></span>  

<span data-ttu-id="f30f8-133">Évitez d’utiliser des emplacements suivants pour stocker les données lors du développement de fonctions personnalisées :</span><span class="sxs-lookup"><span data-stu-id="f30f8-133">Avoid using the following locations to store data when developing custom functions:</span></span>  

- <span data-ttu-id="f30f8-134">`localStorage`: Fonctions personnalisées n’ont pas accès au modèle global `window` objet et par conséquent, n’ont pas accès aux données stockées dans `localStorage`.</span><span class="sxs-lookup"><span data-stu-id="f30f8-134">`localStorage`: Custom functions do not have access to the global `window` object and therefore have no access to data     stored in `localStorage`.</span></span>
- <span data-ttu-id="f30f8-135">`Office.context.document.settings`: Cet emplacement n’est pas sécurisé et informations pouvant être extraites par une personne à l’aide de la macro complémentaire.</span><span class="sxs-lookup"><span data-stu-id="f30f8-135">`Office.context.document.settings`:  This location is not secure and information can be extracted by anyone using the     add-in.</span></span>

## <a name="see-also"></a><span data-ttu-id="f30f8-136">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="f30f8-136">See also</span></span>

* [<span data-ttu-id="f30f8-137">Métadonnées fonctions personnalisées</span><span class="sxs-lookup"><span data-stu-id="f30f8-137">Custom functions metadata</span></span>](custom-functions-json.md)
* [<span data-ttu-id="f30f8-138">Exécution de fonctions personnalisées Excel</span><span class="sxs-lookup"><span data-stu-id="f30f8-138">Runtime for Excel custom functions</span></span>](custom-functions-runtime.md)
* [<span data-ttu-id="f30f8-139">Meilleures pratiques de fonctions personnalisées</span><span class="sxs-lookup"><span data-stu-id="f30f8-139">Custom functions best practices</span></span>](custom-functions-best-practices.md)
* [<span data-ttu-id="f30f8-140">Didacticiel de fonctions personnalisées Excel</span><span class="sxs-lookup"><span data-stu-id="f30f8-140">Excel custom functions tutorial</span></span>](excel-tutorial-custom-functions.md)
