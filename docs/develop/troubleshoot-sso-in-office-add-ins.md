---
title: Résolution des problèmes de messages d’erreur pour l’authentification unique (SSO)
description: ''
ms.date: 12/08/2017
ms.openlocfilehash: ef4d7ed873121deec5fd235e0eace70a3a0c2f0e
ms.sourcegitcommit: 8333ede51307513312d3078cb072f856f5bef8a2
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2018
ms.locfileid: "23876598"
---
# <a name="troubleshoot-error-messages-for-single-sign-on-sso-preview"></a><span data-ttu-id="f804b-102">Résolution des messages d’erreur pour l’authentification unique (SSO) (aperçu)</span><span class="sxs-lookup"><span data-stu-id="f804b-102">Troubleshoot error messages for single sign-on (SSO) (preview)</span></span>

<span data-ttu-id="f804b-103">Cet article fournit des conseils sur la résolution des problèmes liés à l’authentification unique (SSO) dans les compléments Office, et explique comment faire en sorte que votre complément gère correctement les conditions particulières ou les erreurs.</span><span class="sxs-lookup"><span data-stu-id="f804b-103">This article provides some guidance about how to troubleshoot problems with single sign-on (SSO) in Office Add-ins, and how to make your SSO-enabled add-in robustly handle special conditions or errors.</span></span>

> [!NOTE]
> <span data-ttu-id="f804b-104">L’API d'authentification unique est actuellement prise en charge en mode aperçu pour Word, Excel, Outlook et PowerPoint.</span><span class="sxs-lookup"><span data-stu-id="f804b-104">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="f804b-105">Pour plus d’informations à propos de la prise en charge actuelle de l’API d’authentification unique, consultez la rubrique [Ensembles de conditions requises d'IdentityAPI]https://docs.microsoft.com/javascript/office/requirement-sets/identity-api-requirement-sets).</span><span class="sxs-lookup"><span data-stu-id="f804b-105">For more information about where the Single Sign-on API is currently supported, see https://docs.microsoft.com/javascript/office/requirement-sets/identity-api-requirement-sets).</span></span>
> <span data-ttu-id="f804b-106">Pour utiliser l’authentification unique, vous devez charger la version bêta de la bibliothèque JavaScript Office à partir de https://appsforoffice.microsoft.com/lib/beta/hosted/office.js dans la page de démarrage HTML du complément.</span><span class="sxs-lookup"><span data-stu-id="f804b-106">To use SSO, you must load the beta version of the Office JavaScript Library from https://appsforoffice.microsoft.com/lib/beta/hosted/office.js in the startup HTML page of the add-in.</span></span>
> <span data-ttu-id="f804b-107">Si vous utilisez un complément Outlook, veillez à activer l’authentification moderne pour la location d’Office 365.</span><span class="sxs-lookup"><span data-stu-id="f804b-107">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="f804b-108">Pour plus d’informations sur la manière de procéder, consultez la rubrique [Exchange Online : Activation de votre client pour l’authentification moderne](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="f804b-108">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="debugging-tools"></a><span data-ttu-id="f804b-109">Outils de débogage</span><span class="sxs-lookup"><span data-stu-id="f804b-109">Debugging tools</span></span>

<span data-ttu-id="f804b-p102">Lors du développement, nous vous recommandons vivement d’utiliser un outil capable d’intercepter et d’afficher les demandes HTTP du service web de votre complément, ainsi que les réponses. Les deux outils les plus populaires sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="f804b-p102">We strongly recommend that you use a tool that can intercept and display the HTTP Requests from, and Responses to, your add-in's web service when you are developing. Two of the most popular are:</span></span> 

- <span data-ttu-id="f804b-112">[Fiddler](http://www.telerik.com/fiddler) : Gratuit ([documentation](http://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span><span class="sxs-lookup"><span data-stu-id="f804b-112">[Fiddler](http://www.telerik.com/fiddler): Free ([Documentation](http://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span></span>
- <span data-ttu-id="f804b-p103">[Charles](https://www.charlesproxy.com/): Gratuit pendant 30 jours. ([Documentation](https://www.charlesproxy.com/documentation/))</span><span class="sxs-lookup"><span data-stu-id="f804b-p103">[Charles](https://www.charlesproxy.com/): Free for 30 days. ([Documenation](https://www.charlesproxy.com/documentation/))</span></span>

<span data-ttu-id="f804b-115">Lorsque vous développez votre API de service, vous pouvez également essayer :</span><span class="sxs-lookup"><span data-stu-id="f804b-115">When developing your service API, you may also want to try:</span></span>

- <span data-ttu-id="f804b-116">[Postman](http://www.getpostman.com/postman) : Gratuit ([documentation](https://www.getpostman.com/docs/))</span><span class="sxs-lookup"><span data-stu-id="f804b-116">[Postman](http://www.getpostman.com/postman): Free ([Documentation](https://www.getpostman.com/docs/))</span></span>

## <a name="causes-and-handling-of-errors-from-getaccesstokenasync"></a><span data-ttu-id="f804b-117">Causes et gestion des erreurs de getAccessTokenAsync</span><span class="sxs-lookup"><span data-stu-id="f804b-117">Causes and handling of errors from getAccessTokenAsync</span></span>

<span data-ttu-id="f804b-118">Pour consulter des exemples de la gestion des erreurs décrite dans cette section, reportez-vous aux articles suivants :</span><span class="sxs-lookup"><span data-stu-id="f804b-118">For examples of the error handling described in this section, see:</span></span>
- [<span data-ttu-id="f804b-119">Home.js dans Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="f804b-119">Home.js in Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/Home.js)
- [<span data-ttu-id="f804b-120">program.js dans Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="f804b-120">program.js in Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/public/program.js)

> [!NOTE]
> <span data-ttu-id="f804b-121">Outre les suggestions faites dans cette section, un complément Outlook a un moyen supplémentaire pour répondre à n'importe quelle erreur 13*nnn*.</span><span class="sxs-lookup"><span data-stu-id="f804b-121">Besides the suggestions made in this section, an Outlook add-in has an additional way to respond to any 13*nnn* error.</span></span> <span data-ttu-id="f804b-122">Pour plus d’informations, reportez-vous à [Scénario : implémenter l’authentification unique sur votre service dans un complément Outlook](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in) et [Exemple de complément AttachmentsDemo](https://github.com/OfficeDev/outlook-add-in-attachments-demo).</span><span class="sxs-lookup"><span data-stu-id="f804b-122">For more details, see [Scenario: Implement single sign-on to your service in an Outlook Add-in](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in).</span></span> 

### <a name="13000"></a><span data-ttu-id="f804b-123">13000</span><span class="sxs-lookup"><span data-stu-id="f804b-123">13000</span></span>

<span data-ttu-id="f804b-124">L’API [getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) n’est pas prise en charge par le complément ou la version d’Office.</span><span class="sxs-lookup"><span data-stu-id="f804b-124">The [getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) API is not supported by the add-in or the Office version.</span></span> 

- <span data-ttu-id="f804b-p105">La version d’office ne prend pas en charge SSO. La version requise est Office 2016, version 1710, build 8629.nnnn ou version ultérieure (la version par abonnement Office 365, parfois appelée « Démarrer en un clic »). Vous devrez peut-être participer au programme Office Insider pour obtenir cette version. Pour plus d’informations, reportez-vous à la rubrique [Participer au programme Office Insider](https://products.office.com/office-insider?tab=tab-1).</span><span class="sxs-lookup"><span data-stu-id="f804b-p105">The version of Office does not support SSO. The required version is Office 2016, Version 1710, build 8629.nnnn or later (the Office 365 subscription version, sometimes called “Click to Run”). You might need to be an Office Insider to get this version. For more information, see [Be an Office Insider](https://products.office.com/office-insider?tab=tab-1).</span></span> 
- <span data-ttu-id="f804b-129">Le manifeste de complément n’inclut pas la section [WebApplicationInfo](https://dev.office.com/reference/add-ins/manifest/webapplicationinfo) appropriée.</span><span class="sxs-lookup"><span data-stu-id="f804b-129">The add-in manifest is missing the proper [WebApplicationInfo](https://dev.office.com/reference/add-ins/manifest/webapplicationinfo) section.</span></span>

### <a name="13001"></a><span data-ttu-id="f804b-130">13001</span><span class="sxs-lookup"><span data-stu-id="f804b-130">13001</span></span>

<span data-ttu-id="f804b-131">L’utilisateur n’est pas connecté à Office.</span><span class="sxs-lookup"><span data-stu-id="f804b-131">The user is not signed into Office.</span></span> <span data-ttu-id="f804b-132">Votre code doit rappeler la `getAccessTokenAsync` méthode et passer l’option `forceAddAccount: true` dans le paramètre [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference).</span><span class="sxs-lookup"><span data-stu-id="f804b-132">Your code should recall the `getAccessTokenAsync` method and pass the option `forceAddAccount: true` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter.</span></span> <span data-ttu-id="f804b-133">Mais ne le faites pas plus d'une fois.</span><span class="sxs-lookup"><span data-stu-id="f804b-133">But don't do this more than once.</span></span> <span data-ttu-id="f804b-134">L'utilisateur peut avoir décidé de ne pas se connecter.</span><span class="sxs-lookup"><span data-stu-id="f804b-134">The user may have decided not to sign-in.</span></span>

<span data-ttu-id="f804b-135">Cette erreur n’est jamais apparue dans Office Online.</span><span class="sxs-lookup"><span data-stu-id="f804b-135">This error is never seen in Office Online.</span></span> <span data-ttu-id="f804b-136">Si le cookie de l’utilisateur a expiré, Office Online renvoie l’erreur 13006.</span><span class="sxs-lookup"><span data-stu-id="f804b-136">If the user's cookie expires, Office Online returns error 13006.</span></span> 

### <a name="13002"></a><span data-ttu-id="f804b-137">13002</span><span class="sxs-lookup"><span data-stu-id="f804b-137">13002</span></span>

<span data-ttu-id="f804b-138">L'utilisateur a abandonné la connexion ou le consentement ; par exemple, en choisissant **Annuler** dans le dialogue de consentement.</span><span class="sxs-lookup"><span data-stu-id="f804b-138">The user aborted sign in or consent; for example, by choosing **Cancel** on the consent dialog.</span></span> 
- <span data-ttu-id="f804b-139">Si votre complément fournit des fonctions qui ne nécessitent pas la connexion (ou le consentement) de l’utilisateur, votre code doit intercepter cette erreur et autoriser l’exécution du complément.</span><span class="sxs-lookup"><span data-stu-id="f804b-139">If your add-in provides functions that don't require the user to be signed in (or to have granted consent), then your code should catch this error and allow the add-in to stay running.</span></span>
- <span data-ttu-id="f804b-140">Si le complément requiert un utilisateur connecté ayant accordé son consentement, votre code doit demander à l’utilisateur de répéter l’opération, mais pas plus d’une fois.</span><span class="sxs-lookup"><span data-stu-id="f804b-140">If the add-in requires a signed-in user who has granted consent, your code should ask the user to repeat the operation, but not more than once.</span></span> 

### <a name="13003"></a><span data-ttu-id="f804b-141">13003</span><span class="sxs-lookup"><span data-stu-id="f804b-141">13003</span></span>

<span data-ttu-id="f804b-142">Type d’utilisateur non pris en charge.</span><span class="sxs-lookup"><span data-stu-id="f804b-142">User Type not supported.</span></span> <span data-ttu-id="f804b-143">L’utilisateur n’est pas connecté à Office avec un compte Microsoft, Professionnel ou Scolaire valide.</span><span class="sxs-lookup"><span data-stu-id="f804b-143">The user isn't signed into Office with a valid Microsoft Account or Work or School account.</span></span> <span data-ttu-id="f804b-144">Cela peut se produire si Office est exécuté avec un compte de domaine en local, par exemple.</span><span class="sxs-lookup"><span data-stu-id="f804b-144">This may happen if Office runs with an on-premises domain account, for example.</span></span> <span data-ttu-id="f804b-145">Votre code doit demander à l’utilisateur de se connecter à Office.</span><span class="sxs-lookup"><span data-stu-id="f804b-145">Your code should ask the user to sign in to Office.</span></span>

### <a name="13004"></a><span data-ttu-id="f804b-146">13004</span><span class="sxs-lookup"><span data-stu-id="f804b-146">13004</span></span>

<span data-ttu-id="f804b-147">Ressource non valide.</span><span class="sxs-lookup"><span data-stu-id="f804b-147">Invalid Resource.</span></span> <span data-ttu-id="f804b-148">Le manifeste du complément n’a pas été configuré correctement.</span><span class="sxs-lookup"><span data-stu-id="f804b-148">The add-in manifest hasn’t been configured correctly.</span></span> <span data-ttu-id="f804b-149">Mettez à jour le manifeste.</span><span class="sxs-lookup"><span data-stu-id="f804b-149">Update the manifest.</span></span> <span data-ttu-id="f804b-150">Pour plus d’informations, consultez la rubrique [Validation et résolution des problèmes avec votre manifeste](../testing/troubleshoot-manifest.md).</span><span class="sxs-lookup"><span data-stu-id="f804b-150">For more information, see [Validate and troubleshoot issues with your manifest](../testing/troubleshoot-manifest.md).</span></span> <span data-ttu-id="f804b-151">Le problème le plus courant est que l'élément **Resource** (dans l'élément **WebApplicationInfo**) a un domaine qui ne correspond pas au domaine du complément.</span><span class="sxs-lookup"><span data-stu-id="f804b-151">The most commmon problem is that the **Resource** element (in the **WebApplicationInfo** element) has a domain that does not match the domain of the add-in.</span></span> <span data-ttu-id="f804b-152">Bien que la partie protocole de la valeur Resource doive être "api" et non "https", toutes les autres parties du nom de domaine (y compris le port, s'il existe) doivent être les mêmes que pour le complément.</span><span class="sxs-lookup"><span data-stu-id="f804b-152">Although the protocol part of the Resource value should be "api" not "https"; all other parts of the domain name (including port, if any) should be the same as for the add-in.</span></span>

### <a name="13005"></a><span data-ttu-id="f804b-153">13005</span><span class="sxs-lookup"><span data-stu-id="f804b-153">13005</span></span>

<span data-ttu-id="f804b-154">Octroi non valide.</span><span class="sxs-lookup"><span data-stu-id="f804b-154">Invalid Grant.</span></span> <span data-ttu-id="f804b-155">Cela signifie généralement qu’Office n’a pas été pré-autorisé sur le service web du complément.</span><span class="sxs-lookup"><span data-stu-id="f804b-155">This usually means that Office has not been pre-authorized to the add-in's web service.</span></span> <span data-ttu-id="f804b-156">Pour plus d’informations, consultez la rubrique sur la [création de l’application de service](sso-in-office-add-ins.md#create-the-service-application) et sur l’[enregistrement du complément avec le point de terminaison Azure AD v2.0](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) ou sur l’[enregistrement du complément avec le point de terminaison Azure AD v2.0](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (nœud JS).</span><span class="sxs-lookup"><span data-stu-id="f804b-156">For more information, see [Create the service application](sso-in-office-add-ins.md#create-the-service-application) and [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS).</span></span> <span data-ttu-id="f804b-157">Cela peut également arriver si l’utilisateur n’a pas accordé à votre service les autorisations d’application à leur `profile`.</span><span class="sxs-lookup"><span data-stu-id="f804b-157">This also may happen if the user has not granted your service application permissions to his or her `profile`.</span></span>

### <a name="13006"></a><span data-ttu-id="f804b-158">13006</span><span class="sxs-lookup"><span data-stu-id="f804b-158">13006</span></span>

<span data-ttu-id="f804b-p111">Erreur client. Votre code doit suggérer à l’utilisateur de se déconnecter et de redémarrer Office, ou de redémarrer la session Office Online.</span><span class="sxs-lookup"><span data-stu-id="f804b-p111">Client Error. Your code should suggest that the user sign out and restart Office, or restart the Office Online session.</span></span>

### <a name="13007"></a><span data-ttu-id="f804b-161">13007</span><span class="sxs-lookup"><span data-stu-id="f804b-161">13007</span></span>

<span data-ttu-id="f804b-162">L’hôte Office n’a pas pu obtenir de jeton d’accès au service Web du complément.</span><span class="sxs-lookup"><span data-stu-id="f804b-162">The Office host was unable to get an access token to the add-in's web service.</span></span>
- <span data-ttu-id="f804b-163">Si cette erreur se produit pendant le développement, assurez-vous que votre enregistrement de complément et votre manifeste de complément spécifient les autorisations `openid` et `profile`.</span><span class="sxs-lookup"><span data-stu-id="f804b-163">If this error occurs during development, be sure that your add-in registration and add-in manifest specify the `openid` and `profile` permissions.</span></span> <span data-ttu-id="f804b-164">Pour plus d’informations, consultez la rubrique sur l’[enregistrement du complément avec le point de terminaison Azure AD v2.0](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) ou sur l’[enregistrement du complément avec le point de terminaison Azure AD v2.0](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (nœud JS), et sur la [configuration du complément](create-sso-office-add-ins-aspnet.md#configure-the-add-in)(ASP.NET) ou sur la [configuration du complément](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (nœud JS).</span><span class="sxs-lookup"><span data-stu-id="f804b-164">For more information, see [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), and [Configure the add-in](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) or [Configure the add-in](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span></span>
- <span data-ttu-id="f804b-165">En production, il y a plusieurs choses qui peuvent provoquer cette erreur.</span><span class="sxs-lookup"><span data-stu-id="f804b-165">In production, there are several things that can cause this error.</span></span> <span data-ttu-id="f804b-166">En voici certaines :</span><span class="sxs-lookup"><span data-stu-id="f804b-166">Some of them are:</span></span>
    - <span data-ttu-id="f804b-167">L'utilisateur a révoqué son consentement, après l'avoir préalablement accordé.</span><span class="sxs-lookup"><span data-stu-id="f804b-167">The user has revoked consent, after previously granting it.</span></span> <span data-ttu-id="f804b-168">Votre code doit rappeler la méthode `getAccessTokenAsync` avec l’option `forceConsent: true`, mais pas plus d’une fois.</span><span class="sxs-lookup"><span data-stu-id="f804b-168">Your code should recall the `getAccessTokenAsync` method with the option `forceConsent: true`, but no more than once.</span></span>
    - <span data-ttu-id="f804b-169">L'utilisateur possède une identité de compte Microsoft (MSA).</span><span class="sxs-lookup"><span data-stu-id="f804b-169">The user is has an Microsoft Account (MSA) identity.</span></span> <span data-ttu-id="f804b-170">Certaines situations qui entraîneraient l’une des autres erreurs 13nnn avec un compte Work ou School, provoqueront une erreur 13007 lorsqu’un MSA est utilisé.</span><span class="sxs-lookup"><span data-stu-id="f804b-170">Some situations that would cause one of the other 13nnn errors with a Work or School account, will cause a 13007 when a MSA is used.</span></span> 

  <span data-ttu-id="f804b-171">Pour tous ces cas, si vous avez déjà essayé l'option `forceConsent` une fois, votre code pourrait suggérer que l'utilisateur réessaye l'opération plus tard.</span><span class="sxs-lookup"><span data-stu-id="f804b-171">For all of these cases, if you have already tried the `forceConsent` option once, then your code could suggest that the user retry the operation later.</span></span>

### <a name="13008"></a><span data-ttu-id="f804b-172">13008</span><span class="sxs-lookup"><span data-stu-id="f804b-172">13008</span></span>

<span data-ttu-id="f804b-173">L’utilisateur a déclenché une opération qui appelle `getAccessTokenAsync` avant d’avoir terminé une opération qui appelle `getAccessTokenAsync`.</span><span class="sxs-lookup"><span data-stu-id="f804b-173">The user triggered an operation that calls `getAccessTokenAsync` before a previous call of `getAccessTokenAsync` completed.</span></span> <span data-ttu-id="f804b-174">Votre code doit demander à l’utilisateur de répéter l’opération une fois que l’opération précédente sera terminée.</span><span class="sxs-lookup"><span data-stu-id="f804b-174">Your code should ask the user to repeat the operation after the previous operation has completed.</span></span>

### <a name="13009"></a><span data-ttu-id="f804b-175">13009</span><span class="sxs-lookup"><span data-stu-id="f804b-175">13009</span></span>

<span data-ttu-id="f804b-176">Le complément a appelé la méthode `getAccessTokenAsync` avec l’option `forceConsent: true`, mais le manifeste du complément est déployé sur un type de catalogue qui ne prend pas en charge le consentement forcé.</span><span class="sxs-lookup"><span data-stu-id="f804b-176">The add-in called the `getAccessTokenAsync` method with the option `forceConsent: true`, but the add-in's manifest is deployed to a type of catalog that does not support forcing consent.</span></span> <span data-ttu-id="f804b-177">Votre code doit rappeler la `getAccessTokenAsync` méthode et passer l’option `forceConsent: false` dans le paramètre [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference).</span><span class="sxs-lookup"><span data-stu-id="f804b-177">Your code should recall the `getAccessTokenAsync` method and pass the option `forceConsent: false` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter.</span></span> <span data-ttu-id="f804b-178">Toutefois, l’appel de `getAccessTokenAsync` avec `forceConsent: true` peut lui-même représenter une réponse automatique à un appel ayant échoué de `getAccessTokenAsync` avec `forceConsent: false`, donc votre code doit suivre si `getAccessTokenAsync` avec `forceConsent: false` a déjà été appelé.</span><span class="sxs-lookup"><span data-stu-id="f804b-178">However, the call of  `getAccessTokenAsync`  with `forceConsent: true` might itself have been an automatic response to a failed call of `getAccessTokenAsync` with `forceConsent: false`, so your code should keep track of whether `getAccessTokenAsync` with `forceConsent: false` has already been called.</span></span> <span data-ttu-id="f804b-179">Si c’est le cas, votre code doit indiquer à l’utilisateur de se déconnecter d’Office et de se connecter à nouveau.</span><span class="sxs-lookup"><span data-stu-id="f804b-179">If it has, your code should tell the user to sign out of Office and sign-in again.</span></span>

> [!NOTE]
> <span data-ttu-id="f804b-180">Microsoft n’imposera pas nécessairement cette restriction sur tous les types de catalogues de compléments.</span><span class="sxs-lookup"><span data-stu-id="f804b-180">Microsoft will not necessarilly impose this restriction on any types of add-in catalogs.</span></span> <span data-ttu-id="f804b-181">Si la restriction ne s’applique pas, l’erreur n’est jamais affichée.</span><span class="sxs-lookup"><span data-stu-id="f804b-181">If it doesn't, then this error will never be seen.</span></span>

### <a name="13010"></a><span data-ttu-id="f804b-182">13010</span><span class="sxs-lookup"><span data-stu-id="f804b-182">13010</span></span>

<span data-ttu-id="f804b-183">L’utilisateur exécute le complément sur Office Online et utilise Edge ou Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="f804b-183">The user is running the add-in on Office Online and is using Edge or Internet Explorer.</span></span> <span data-ttu-id="f804b-184">Le domaine Office 365 de l’utilisateur et le domaine login.microsoftonline.com sont dans des zones de sécurité distinctes dans les paramètres de navigateur.</span><span class="sxs-lookup"><span data-stu-id="f804b-184">The user’s Office 365 domain, and the login.microsoftonline.com domain, are in a different security zones in the browser settings.</span></span> <span data-ttu-id="f804b-185">Si cette erreur est renvoyée, l’utilisateur a déjà vu une erreur expliquant cela et menant vers une page sur la modification de la configuration de la zone.</span><span class="sxs-lookup"><span data-stu-id="f804b-185">If this error is returned, the user will have already seen an error explaining this and linking to a page about how to change the zone configuration.</span></span> <span data-ttu-id="f804b-186">Si votre complément fournit des fonctions qui ne nécessitent pas que l’utilisateur soit connecté, votre code doit intercepter cette erreur et autoriser l’exécution du complément.</span><span class="sxs-lookup"><span data-stu-id="f804b-186">If your add-in provides functions that don't require the user to be signed in, then your code should catch this error and allow the add-in to stay running.</span></span>

### <a name="50001"></a><span data-ttu-id="f804b-187">50001</span><span class="sxs-lookup"><span data-stu-id="f804b-187">50001</span></span>

<span data-ttu-id="f804b-188">Cette erreur (qui n'est pas spécifique à `getAccessTokenAsync`) peut indiquer que le navigateur a en cache une ancienne copie des fichiers office.js.</span><span class="sxs-lookup"><span data-stu-id="f804b-188">This error (which is not specific to `getAccessTokenAsync`) may indicate that the browser has cashed an old copy of the office.js files.</span></span> <span data-ttu-id="f804b-189">Effacez le cache du navigateur.</span><span class="sxs-lookup"><span data-stu-id="f804b-189">Clear the Office cache</span></span> <span data-ttu-id="f804b-190">Une autre possibilité est que la version d'Office n'est pas suffisamment récente pour prendre en charge SSO.</span><span class="sxs-lookup"><span data-stu-id="f804b-190">Another possibility is that the version of Office is not recent enough to support SSO.</span></span> <span data-ttu-id="f804b-191">Voir [Conditions préalables](create-sso-office-add-ins-aspnet.md#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="f804b-191">See [Prerequisites](create-sso-office-add-ins-aspnet.md#prerequisites).</span></span>

## <a name="errors-on-the-server-side-from-azure-active-directory"></a><span data-ttu-id="f804b-192">Erreurs d’Azure Active Directory côté serveur</span><span class="sxs-lookup"><span data-stu-id="f804b-192">Errors on the server-side from Azure Active Directory</span></span>

<span data-ttu-id="f804b-193">Pour plus d’exemples de la gestion des erreurs décrite dans cette section, reportez-vous aux articles suivants :</span><span class="sxs-lookup"><span data-stu-id="f804b-193">For samples of the error-handling described in this section, see:</span></span>
- [<span data-ttu-id="f804b-194">Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="f804b-194">Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO)
- [<span data-ttu-id="f804b-195">Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="f804b-195">Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO)


### <a name="conditional-access--multifactor-authentication-errors"></a><span data-ttu-id="f804b-196">Erreurs d’accès conditionnel / authentification multifacteur</span><span class="sxs-lookup"><span data-stu-id="f804b-196">Conditional access / Multifactor authentication errors</span></span>
 
<span data-ttu-id="f804b-197">Dans certaines configurations d’identité sur AAD et Office 365, il est possible pour certaines ressources accessibles via Microsoft Graph d’exiger une authentification multifacteur (AMF), même lorsque ce n’est pas le cas de la location Office 365 de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f804b-197">In certain configurations of identity in AAD and Office 365, it is possible for some resources that are accessible with Microsoft Graph to require multifactor authentication (MFA), even when the user's Office 365 tenancy does not.</span></span> <span data-ttu-id="f804b-198">Lorsqu’AAD reçoit une requête pour obtenir un jeton d’accès à la ressource protégée par AMF via le flux « de la part de », il renvoie au service web de votre complément un message JSON contenant une propriété `claims`.</span><span class="sxs-lookup"><span data-stu-id="f804b-198">When AAD receives a request for a token to the MFA-protected resource, via the on-behalf-of flow, it returns to your add-in's web service a JSON message that contains a `claims` property.</span></span> <span data-ttu-id="f804b-199">La propriété de revendication comporte des informations sur les facteurs d’authentification supplémentaires nécessaires.</span><span class="sxs-lookup"><span data-stu-id="f804b-199">The claims property has information about what further authentication factors are needed.</span></span> 

<span data-ttu-id="f804b-200">Votre code côté serveur doit tester ce message et relayer la valeur de revendication à votre code côté client.</span><span class="sxs-lookup"><span data-stu-id="f804b-200">Your server-side code should test for this message and relay the claims value to your client-side code.</span></span> <span data-ttu-id="f804b-201">Il vous faut ces informations dans le client, car Office gère l’authentification des compléments SSO. Le message adressé au client peut être une erreur (telle que `500 Server Error` ou `401 Unauthorized`) ou se trouver dans le corps d’une réponse de succès (telle que `200 OK`).</span><span class="sxs-lookup"><span data-stu-id="f804b-201">You need this information in the client because Office handles authentication for SSO add-ins. The message to the client can be either an error (such as `500 Server Error` or `401 Unauthorized`) or in the body of a success response (such as `200 OK`).</span></span> <span data-ttu-id="f804b-202">Dans les deux cas, le rappel (réussite ou échec) de l’appel AJAX de votre code côté client à l’API web de votre complément devra tester cette réponse.</span><span class="sxs-lookup"><span data-stu-id="f804b-202">In either case, the (failure or success) callback of your code's client-side AJAX call to your add-in's web API should test for this response.</span></span> <span data-ttu-id="f804b-203">Si la valeur de revendication a été relayée, votre code doit rappeler `getAccessTokenAsync` et transmettre l’option `authChallenge: CLAIMS-STRING-HERE` dans le paramètre [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference).</span><span class="sxs-lookup"><span data-stu-id="f804b-203">If the claims value has been relayed, your code should recall `getAccessTokenAsync` and pass the option `authChallenge: CLAIMS-STRING-HERE` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter.</span></span> <span data-ttu-id="f804b-204">Lorsqu’AAD voit cette chaîne, il demande le(s) facteur(s) supplémentaire(s) à l’utilisateur, puis renvoie un nouveau jeton d’accès qui sera accepté dans le flux « de la part de ».</span><span class="sxs-lookup"><span data-stu-id="f804b-204">When AAD sees this string, it prompts the user for the additional factor(s) and then returns a new access token which will be accepted in the on-behalf-of flow.</span></span>

### <a name="consent-missing-errors"></a><span data-ttu-id="f804b-205">Erreurs de consentement manquant</span><span class="sxs-lookup"><span data-stu-id="f804b-205">Consent missing errors</span></span>

<span data-ttu-id="f804b-206">Si AAD ne détient aucune trace qu’un consentement (à la ressource Microsoft Graph) a été accordé au complément par l’utilisateur (ou administrateur client), AAD envoie un message d’erreur à votre service web.</span><span class="sxs-lookup"><span data-stu-id="f804b-206">If AAD has no record that consent (to the Microsoft Graph resource) was granted to the add-in by the user (or tenant administrator), AAD will send an error message to your web service.</span></span> <span data-ttu-id="f804b-207">Votre code doit indiquer au client (dans le corps d’une réponse `403 Forbidden`, par exemple) qu’il doit rappeler `getAccessTokenAsync` avec l’option `forceConsent: true`.</span><span class="sxs-lookup"><span data-stu-id="f804b-207">Your code must tell the client (in the body of a `403 Forbidden` response, for example) to recall `getAccessTokenAsync` with the `forceConsent: true` option.</span></span>

### <a name="invalid-or-missing-scope-permission-errors"></a><span data-ttu-id="f804b-208">Erreurs d’étendue (permission) non valide ou manquante</span><span class="sxs-lookup"><span data-stu-id="f804b-208">Invalid or missing scope (permission) errors</span></span>

- <span data-ttu-id="f804b-p124">Votre code côté serveur doit envoyer une réponse `403 Forbidden` au client, qui doit présenter un message amical à l’utilisateur. Si possible, consignez l’erreur dans la console ou enregistrez-la dans un journal.</span><span class="sxs-lookup"><span data-stu-id="f804b-p124">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user. If possible, log the error to the console or record it in a log.</span></span>
- <span data-ttu-id="f804b-211">Assurez-vous que la section [Scopes](https://dev.office.com/reference/add-ins/manifest/scopes) du manifeste de votre complément indique toutes les autorisations nécessaires.</span><span class="sxs-lookup"><span data-stu-id="f804b-211">Be sure your add-in manifest [Scopes](https://dev.office.com/reference/add-ins/manifest/scopes)  section specifies all needed permissions.</span></span> <span data-ttu-id="f804b-212">Vérifiez également que l’alignement du service web de votre complément spécifie les mêmes autorisations.</span><span class="sxs-lookup"><span data-stu-id="f804b-212">And be sure your registration of the add-in's web service specifies the same permissions.</span></span> <span data-ttu-id="f804b-213">Vérifiez les fautes d’orthographe.</span><span class="sxs-lookup"><span data-stu-id="f804b-213">Check for spelling mistakes too.</span></span> <span data-ttu-id="f804b-214">Pour plus d’informations, consultez la rubrique sur l’[enregistrement du complément avec le point de terminaison Azure AD v2.0](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) ou sur l’[enregistrement du complément avec le point de terminaison Azure AD v2.0](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (nœud JS), et sur la [configuration du complément](create-sso-office-add-ins-aspnet.md#configure-the-add-in)(ASP.NET) ou sur la [configuration du complément](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (nœud JS).</span><span class="sxs-lookup"><span data-stu-id="f804b-214">For more information, see [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), and [Configure the add-in](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) or [Configure the add-in](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span></span>

### <a name="expired-or-invalid-token-errors-when-calling-microsoft-graph"></a><span data-ttu-id="f804b-215">Erreurs de jetons expirés ou invalides lors de l’appel à Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="f804b-215">Expired or invalid token errors when calling Microsoft Graph</span></span>

<span data-ttu-id="f804b-216">Certaines bibliothèques d’autorisation et d’authentification, y compris MSAL, évitent les erreurs de jetons expirés grâce à un jeton d’actualisation mis en cache.</span><span class="sxs-lookup"><span data-stu-id="f804b-216">Some authentication and authorization libraries, including MSAL, prevent expired token errors by using a cached refresh token whenever necessary.</span></span> <span data-ttu-id="f804b-217">Vous pouvez également coder votre propre système de mise en cache de jeton.</span><span class="sxs-lookup"><span data-stu-id="f804b-217">You can also code your own token caching system.</span></span> <span data-ttu-id="f804b-218">Pour un exemple, consultez la rubrique [SSO NodeJS pour complément Office](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO), notamment le fichier [auth.ts](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/src/auth.ts).</span><span class="sxs-lookup"><span data-stu-id="f804b-218">For a sample that does this, see [Office Add-in NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO), especially the file [auth.ts](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/src/auth.ts).</span></span>

<span data-ttu-id="f804b-219">Cependant, si vous recevez un message d’erreur pour jeton expiré ou invalide, votre code doit demander au client (dans le corps d’une réponse `401 Unauthorized`, par exemple) de rappeler `getAccessTokenAsync` et répéter l’appel vers le point de terminaison de l’API web de votre complément, qui répétera le flux « de la part de » afin d’obtenir un nouveau jeton pour Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="f804b-219">But if you get an expired token or invalid token error, your code must tell the client (in the body of a `401 Unauthorized` response, for example) to recall `getAccessTokenAsync` and repeat the call to the endpoint of your add-in's web API, which will repeat the on-behalf-of flow to obtain a new token for Microsoft Graph.</span></span> 

### <a name="invalid-token-error-when-calling-microsoft-graph"></a><span data-ttu-id="f804b-220">Erreur de jeton non valide lors de l’appel à Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="f804b-220">Invalid token error when calling Microsoft Graph</span></span>

<span data-ttu-id="f804b-p127">Gérez cette erreur de la même manière qu’une erreur de jeton expiré. Consultez la section précédente.</span><span class="sxs-lookup"><span data-stu-id="f804b-p127">Handle this error the same as an expired token error. See previous section.</span></span>

### <a name="invalid-audience-error"></a><span data-ttu-id="f804b-223">Erreur de public non valide</span><span class="sxs-lookup"><span data-stu-id="f804b-223">Invalid audience error</span></span>

<span data-ttu-id="f804b-224">Votre code côté serveur doit envoyer une réponse `403 Forbidden` au client, qui doit présenter un message amical à l’utilisateur et éventuellement consigner l’erreur dans la console ou l’enregistrer dans un journal.</span><span class="sxs-lookup"><span data-stu-id="f804b-224">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user and possibly also log the error to the console or record it in a log.</span></span>

<span data-ttu-id="f804b-225">Pour plus d’informations sur l’ajout de prise en charge multi-locataire pour la validation de jeton, consultez la rubrique [Exemple de multi-locataire Azure](https://github.com/Azure-Samples/active-directory-dotnet-webapp-webapi-multitenant-openidconnect).</span><span class="sxs-lookup"><span data-stu-id="f804b-225">For more on adding multitenant support for token validation, see the [Azure Multitenant Sample](https://github.com/Azure-Samples/active-directory-dotnet-webapp-webapi-multitenant-openidconnect).</span></span>
