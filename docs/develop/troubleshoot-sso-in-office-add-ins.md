---
title: Résolution des problèmes de messages d’erreur pour l’authentification unique (SSO)
description: ''
ms.date: 11/05/2019
localization_priority: Priority
ms.openlocfilehash: 835ae68304a6fd69648f0f182c9ff17e9cbfd56d
ms.sourcegitcommit: d5ac9284d1e96dc91a9168d7641e44d88535e1a7
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/31/2019
ms.locfileid: "40914880"
---
# <a name="troubleshoot-error-messages-for-single-sign-on-sso-preview"></a><span data-ttu-id="f9d1a-102">Résolution des messages d’erreur pour l’authentification unique (SSO) (aperçu)</span><span class="sxs-lookup"><span data-stu-id="f9d1a-102">Troubleshoot error messages for single sign-on (SSO) (preview)</span></span>

<span data-ttu-id="f9d1a-103">Cet article fournit des conseils sur la résolution des problèmes liés à l’authentification unique (SSO) dans les compléments Office, et explique comment faire en sorte que votre complément gère correctement les conditions particulières ou les erreurs.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-103">This article provides some guidance about how to troubleshoot problems with single sign-on (SSO) in Office Add-ins, and how to make your SSO-enabled add-in robustly handle special conditions or errors.</span></span>

> [!NOTE]
> <span data-ttu-id="f9d1a-104">L’API de l’authentification unique est actuellement prise en charge en mode aperçu pour Word, Excel, Outlook et PowerPoint.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-104">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="f9d1a-105">Pour plus d’informations sur l’endroit où l’API d’authentification unique est actuellement prise en charge, consultez la rubrique [Ensembles de conditions requises de l’API d’identité](../reference/requirement-sets/identity-api-requirement-sets.md).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-105">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](../reference/requirement-sets/identity-api-requirement-sets.md).</span></span>
> [!INCLUDE [Information about using preview APIs](../includes/using-excel-preview-apis.md)]
> <span data-ttu-id="f9d1a-106">Si vous utilisez un complément Outlook, veillez à activer l’authentification moderne pour la location d’Office 365.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-106">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="f9d1a-107">Pour plus d’informations sur la manière de procéder, consultez la rubrique [Exchange Online : Activation de votre client pour l’authentification moderne](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-107">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="debugging-tools"></a><span data-ttu-id="f9d1a-108">Outils de débogage</span><span class="sxs-lookup"><span data-stu-id="f9d1a-108">Debugging tools</span></span>

<span data-ttu-id="f9d1a-p103">Lors du développement, nous vous recommandons vivement d’utiliser un outil capable d’intercepter et d’afficher les demandes HTTP du service web de votre complément, ainsi que les réponses. Les deux outils les plus populaires sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="f9d1a-p103">We strongly recommend that you use a tool that can intercept and display the HTTP Requests from, and Responses to, your add-in's web service when you are developing. Two of the most popular are:</span></span>

- <span data-ttu-id="f9d1a-111">[Fiddler](https://www.telerik.com/fiddler) : Gratuit ([documentation](https://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span><span class="sxs-lookup"><span data-stu-id="f9d1a-111">[Fiddler](https://www.telerik.com/fiddler): Free ([Documentation](https://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span></span>
- <span data-ttu-id="f9d1a-112">[Charles](https://www.charlesproxy.com) : Gratuit pendant 30 jours.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-112">[Charles](https://www.charlesproxy.com): Free for 30 days.</span></span> <span data-ttu-id="f9d1a-113">([Documentation](https://www.charlesproxy.com/documentation/))</span><span class="sxs-lookup"><span data-stu-id="f9d1a-113">([Documentation](https://www.charlesproxy.com/documentation/))</span></span>

## <a name="causes-and-handling-of-errors-from-getaccesstoken"></a><span data-ttu-id="f9d1a-114">Causes et gestion des erreurs de getAccessToken</span><span class="sxs-lookup"><span data-stu-id="f9d1a-114">Causes and handling of errors from getAccessToken</span></span>

<span data-ttu-id="f9d1a-115">Pour consulter des exemples de la gestion des erreurs décrite dans cette section, reportez-vous aux articles suivants :</span><span class="sxs-lookup"><span data-stu-id="f9d1a-115">For examples of the error handling described in this section, see:</span></span>
- [<span data-ttu-id="f9d1a-116">HomeES6.js dans Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="f9d1a-116">HomeES6.js in Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/src/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/HomeES6.js)
- [<span data-ttu-id="f9d1a-117">ssoAuthES6.js dans Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="f9d1a-117">ssoAuthES6.js in Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/src/public/javascripts/ssoAuthES6.js)

### <a name="13000"></a><span data-ttu-id="f9d1a-118">13000</span><span class="sxs-lookup"><span data-stu-id="f9d1a-118">13000</span></span>

<span data-ttu-id="f9d1a-119">L’API [getAccessToken](/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) n’est pas prise en charge par le complément ou la version d’Office.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-119">The [getAccessToken](/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) API is not supported by the add-in or the Office version.</span></span>

- <span data-ttu-id="f9d1a-120">La version d’Office ne prend pas en charge la SSO.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-120">The version of Office does not support SSO.</span></span> <span data-ttu-id="f9d1a-121">La version requise est Office 365 (version d’Office par abonnement), quel que soit le canal mensuel.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-121">The required version is Office 365 (the subscription version of Office), in any monthly channel.</span></span> 
- <span data-ttu-id="f9d1a-122">Le manifeste de complément n’inclut pas la section [WebApplicationInfo](/office/dev/add-ins/reference/manifest/webapplicationinfo) appropriée.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-122">The add-in manifest is missing the proper [WebApplicationInfo](/office/dev/add-ins/reference/manifest/webapplicationinfo) section.</span></span>

<span data-ttu-id="f9d1a-123">Votre complément doit corriger cette erreur en basculant vers un autre système d’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-123">Your add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="f9d1a-124">Pour plus d’informations, voir [Meilleures Pratiques et Conditions Requises](/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-124">For more information, see [Requirements and Best Practices](/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span></span>

### <a name="13001"></a><span data-ttu-id="f9d1a-125">13001</span><span class="sxs-lookup"><span data-stu-id="f9d1a-125">13001</span></span>

<span data-ttu-id="f9d1a-126">L’utilisateur n’est pas connecté à Office.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-126">The user is not signed into Office.</span></span> <span data-ttu-id="f9d1a-127">Dans la plupart des cas, vous devez éviter cette erreur en transmettant l’option `allowSignInPrompt: true` dans le paramètre `AuthOptions`.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-127">In most scenarios, you should prevent this error from ever being seen by passing the option `allowSignInPrompt: true` in the `AuthOptions` parameter.</span></span>

<span data-ttu-id="f9d1a-128">Il peut toutefois y avoir des exceptions.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-128">But there may be exceptions.</span></span> <span data-ttu-id="f9d1a-129">Par exemple, vous souhaitez que le complément s’ouvre avec des fonctionnalités qui nécessitent un utilisateur connecté, mais *uniquement si* l’utilisateur a *déjà* ouvert une session dans Office.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-129">For example, you want the add-in to open with features that require a logged in user; but *only if* the user is *already* logged into Office.</span></span> <span data-ttu-id="f9d1a-130">Si ce n’est pas le cas, vous voulez que le complément s’ouvre avec un autre groupe de fonctionnalités qui n’exigent pas que l’utilisateur soit connecté.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-130">If the user is not, you want the add-in to open with an alternate set of features that do not require that the user is signed in.</span></span> <span data-ttu-id="f9d1a-131">Dans ce cas, la logique qui s’exécute lorsque le complément lance des appels `getAccessToken` sans `allowSignInPrompt: true`.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-131">In this case, logic which runs when the add-in launches calls `getAccessToken` without `allowSignInPrompt: true`.</span></span> <span data-ttu-id="f9d1a-132">Utilisez l’erreur 13001 comme indicateur pour indiquer au complément de présenter l’autre groupe de fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-132">Use the 13001 error as the flag to tell the add-in to present the alternate set of features.</span></span>

<span data-ttu-id="f9d1a-133">Une autre option consiste à répondre au 13001 en basculant vers un autre système d’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-133">Another option is to respond to 13001 by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="f9d1a-134">Cette opération permet de connecter l’utilisateur à AAD, mais pas à Office.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-134">This will sign the user into AAD, but not sign the user into Office.</span></span>

<span data-ttu-id="f9d1a-135">Cette erreur n’est jamais apparue dans **Office sur le web**.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-135">This error is never seen in **Office on the web**.</span></span> <span data-ttu-id="f9d1a-136">Si le cookie de l’utilisateur a expiré, **Office sur le web** renvoie l’erreur 13006.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-136">If the user's cookie expires, **Office on the web** returns error 13006.</span></span>

### <a name="13002"></a><span data-ttu-id="f9d1a-137">13002</span><span class="sxs-lookup"><span data-stu-id="f9d1a-137">13002</span></span>

<span data-ttu-id="f9d1a-138">L’utilisateur a annulé la connexion ou l’autorisation, par exemple, en choisissant **Annuler** dans la boîte de dialogue d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-138">The user aborted sign in or consent; for example, by choosing **Cancel** on the consent dialog.</span></span>

- <span data-ttu-id="f9d1a-139">Si votre complément fournit des fonctions qui ne nécessitent pas la connexion (ou le consentement) de l’utilisateur, votre code doit intercepter cette erreur et autoriser l’exécution du complément.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-139">If your add-in provides functions that don't require the user to be signed in (or to have granted consent), then your code should catch this error and allow the add-in to stay running.</span></span>
- <span data-ttu-id="f9d1a-140">Si le complément requiert un utilisateur connecté qui a donné son accord, votre code doit inclure un bouton de connexion qui s’affiche.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-140">If the add-in requires a signed-in user who has granted consent, your code should have a sign-in button appear.</span></span>

### <a name="13003"></a><span data-ttu-id="f9d1a-141">13003</span><span class="sxs-lookup"><span data-stu-id="f9d1a-141">13003</span></span>

<span data-ttu-id="f9d1a-142">Type d’utilisateur non pris en charge.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-142">User Type not supported.</span></span> <span data-ttu-id="f9d1a-143">L’utilisateur n’est pas connecté à Office avec un compte Microsoft ou un compte Office 365 professionnel ou scolaire valide.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-143">The user isn't signed into Office with a valid Microsoft Account or Office 365 ("Work or School") account.</span></span> <span data-ttu-id="f9d1a-144">Cela peut se produire si Office est exécuté avec un compte de domaine en local, par exemple.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-144">This may happen if Office runs with an on-premises domain account, for example.</span></span> <span data-ttu-id="f9d1a-145">Votre code doit basculer vers un autre système d’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-145">Your code should fall back to an alternate system of user authentication.</span></span> <span data-ttu-id="f9d1a-146">Pour plus d’informations, voir [Meilleures Pratiques et Conditions Requises](/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-146">For more information, see [Requirements and Best Practices](/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span></span>

### <a name="13004"></a><span data-ttu-id="f9d1a-147">13004</span><span class="sxs-lookup"><span data-stu-id="f9d1a-147">13004</span></span>

<span data-ttu-id="f9d1a-148">Ressource non valide.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-148">Invalid Resource.</span></span> <span data-ttu-id="f9d1a-149">(Cette erreur ne doit être détectée qu’en développement.) Le manifeste du complément n’a pas été correctement configuré.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-149">(This error should only be seen in development.) The add-in manifest hasn’t been configured correctly.</span></span> <span data-ttu-id="f9d1a-150">Mettez à jour le manifeste.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-150">Update the manifest.</span></span> <span data-ttu-id="f9d1a-151">Pour en savoir plus, consultez [Valider le manifeste d’un complément Office](../testing/troubleshoot-manifest.md).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-151">For more information, see [Validate an Office Add-in's manifest](../testing/troubleshoot-manifest.md).</span></span> <span data-ttu-id="f9d1a-152">Le problème le plus courant est que l’élément **Resource** (dans l’élément **WebApplicationInfo**) a un domaine qui ne correspond pas au domaine du complément.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-152">The most common problem is that the **Resource** element (in the **WebApplicationInfo** element) has a domain that does not match the domain of the add-in.</span></span> <span data-ttu-id="f9d1a-153">Bien que la partie protocole de la valeur Resource devrait être « api » et non « https », toutes les autres parties du nom de domaine (dont le port éventuel) doivent être identiques à ceux du complément.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-153">Although the protocol part of the Resource value should be "api" not "https"; all other parts of the domain name (including port, if any) should be the same as for the add-in.</span></span>

### <a name="13005"></a><span data-ttu-id="f9d1a-154">13005</span><span class="sxs-lookup"><span data-stu-id="f9d1a-154">13005</span></span>

<span data-ttu-id="f9d1a-155">Octroi non valide.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-155">Invalid Grant.</span></span> <span data-ttu-id="f9d1a-156">Cela signifie généralement qu’Office n’a pas été pré-autorisé sur le service web du complément.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-156">This usually means that Office has not been pre-authorized to the add-in's web service.</span></span> <span data-ttu-id="f9d1a-157">Pour plus d’informations, consultez la rubrique sur la [création de l’application de service](sso-in-office-add-ins.md#create-the-service-application) et sur l’[enregistrement du complément avec le point de terminaison Azure AD v2.0](register-sso-add-in-aad-v2.md).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-157">For more information, see [Create the service application](sso-in-office-add-ins.md#create-the-service-application) and [Register the add-in with Azure AD v2.0 endpoint](register-sso-add-in-aad-v2.md).</span></span> <span data-ttu-id="f9d1a-158">Cela peut également arriver si l’utilisateur n’a pas accordé à votre service les autorisations d’application pour son `profile` ou a révoqué l’accord.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-158">This also may happen if the user has not granted your service application permissions to their `profile`, or has revoked consent.</span></span> <span data-ttu-id="f9d1a-159">Votre code doit basculer vers un autre système d’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-159">Your code should fall back to an alternate system of user authentication.</span></span>

<span data-ttu-id="f9d1a-160">Une autre cause possible, lors du développement, est que votre complément utilise Internet Explorer et que vous utilisez un certificat auto-signé.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-160">Another possible cause, during development, is that your add-in using Internet Explorer, and you are using a self-signed certificate.</span></span> <span data-ttu-id="f9d1a-161">(Pour déterminer quel navigateur est utilisé par le complément, consultez [Navigateurs utilisés par les compléments Office](../concepts/browsers-used-by-office-web-add-ins.md).)</span><span class="sxs-lookup"><span data-stu-id="f9d1a-161">(To determine which browser is being used by the add-in, see [Browsers used by Office Add-ins](../concepts/browsers-used-by-office-web-add-ins.md).)</span></span>

### <a name="13006"></a><span data-ttu-id="f9d1a-162">13006</span><span class="sxs-lookup"><span data-stu-id="f9d1a-162">13006</span></span>

<span data-ttu-id="f9d1a-163">Erreur du client.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-163">Client Error.</span></span> <span data-ttu-id="f9d1a-164">Cette erreur apparaît uniquement dans **Office sur le web**.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-164">This error is only seen in **Office on the web**.</span></span> <span data-ttu-id="f9d1a-165">Votre code doit suggérer à l’utilisateur de se déconnecter et de redémarrer la session de navigateur Office.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-165">Your code should suggest that the user sign out and then restart the Office browser session.</span></span>

### <a name="13007"></a><span data-ttu-id="f9d1a-166">13007</span><span class="sxs-lookup"><span data-stu-id="f9d1a-166">13007</span></span>

<span data-ttu-id="f9d1a-167">L’hôte Office n’a pas pu obtenir de jeton d’accès au service web du complément.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-167">The Office host was unable to get an access token to the add-in's web service.</span></span>

- <span data-ttu-id="f9d1a-168">Si cette erreur se produit en cours de développement, assurez-vous que l’enregistrement de votre complément, ainsi que son manifeste, spécifient l’autorisation `profile` (et l’autorisation `openid` si vous utilisez MSAL.NET).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-168">If this error occurs during development, be sure that your add-in registration and add-in manifest specify the `profile` permission (and the `openid` permission, if you are using MSAL.NET).</span></span> <span data-ttu-id="f9d1a-169">Pour plus d’informations, voir [Inscrire votre complément avec le point de terminaison Azure AD v2.0](register-sso-add-in-aad-v2.md).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-169">For more information, see [Register the add-in with Azure AD v2.0 endpoint](register-sso-add-in-aad-v2.md).</span></span>
- <span data-ttu-id="f9d1a-170">En production, plusieurs causes peuvent entraîner cette erreur.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-170">In production, there are several things that can cause this error.</span></span> <span data-ttu-id="f9d1a-171">En voici certaines :</span><span class="sxs-lookup"><span data-stu-id="f9d1a-171">Some of them are:</span></span>
    - <span data-ttu-id="f9d1a-172">L’utilisateur dispose d’une identité de compte de service administré Microsoft (MSA).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-172">The user has an Microsoft Account (MSA) identity.</span></span>
    - <span data-ttu-id="f9d1a-173">Certaines situations susceptibles d’occasionner d’autres erreurs 13xxx avec un compte professionnel ou scolaire entraînent un erreur 13007 en cas d’utilisation d’un compte MSA.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-173">Some situations that would cause one of the other 13xxx errors with a Work or School account, will cause a 13007 when a MSA is used.</span></span>

  <span data-ttu-id="f9d1a-174">Dans tous ces cas, votre code doit basculer vers un autre système d’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-174">For all of these cases, your code should fall back to an alternate system of user authentication.</span></span>

### <a name="13008"></a><span data-ttu-id="f9d1a-175">13008</span><span class="sxs-lookup"><span data-stu-id="f9d1a-175">13008</span></span>

<span data-ttu-id="f9d1a-176">L’utilisateur a déclenché une opération qui appelle `getAccessToken` avant d’avoir terminé une opération qui appelle `getAccessToken`.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-176">The user triggered an operation that calls `getAccessToken` before a previous call of `getAccessToken` completed.</span></span> <span data-ttu-id="f9d1a-177">Cette erreur apparaît uniquement dans **Office sur le web**.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-177">This error is only seen on **Office on the web**.</span></span> <span data-ttu-id="f9d1a-178">Votre code doit demander à l’utilisateur de répéter l’opération une fois que l’opération précédente sera terminée.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-178">Your code should ask the user to repeat the operation after the previous operation has completed.</span></span>

### <a name="13010"></a><span data-ttu-id="f9d1a-179">13010</span><span class="sxs-lookup"><span data-stu-id="f9d1a-179">13010</span></span>

<span data-ttu-id="f9d1a-180">L’utilisateur exécute le complément dans Office sur Microsoft Edge ou Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-180">The user is running the add-in in Office on Microsoft Edge or Internet Explorer.</span></span> <span data-ttu-id="f9d1a-181">Le domaine Office 365 de l’utilisateur et le domaine `login.microsoftonline.com` sont dans des zones de sécurité distinctes dans les paramètres de navigateur.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-181">The user’s Office 365 domain, and the `login.microsoftonline.com` domain, are in a different security zones in the browser settings.</span></span> <span data-ttu-id="f9d1a-182">Cette erreur apparaît uniquement dans **Office sur le web**.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-182">This error is only seen on **Office on the web**.</span></span> <span data-ttu-id="f9d1a-183">Si cette erreur est renvoyée, l’utilisateur a déjà vu une erreur expliquant cela et menant vers une page sur la modification de la configuration de la zone.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-183">If this error is returned, the user will have already seen an error explaining this and linking to a page about how to change the zone configuration.</span></span> <span data-ttu-id="f9d1a-184">Si votre complément fournit des fonctions qui ne nécessitent pas que l’utilisateur soit connecté, votre code doit intercepter cette erreur et autoriser l’exécution du complément.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-184">If your add-in provides functions that don't require the user to be signed in, then your code should catch this error and allow the add-in to stay running.</span></span>

### <a name="13012"></a><span data-ttu-id="f9d1a-185">13012</span><span class="sxs-lookup"><span data-stu-id="f9d1a-185">13012</span></span>

<span data-ttu-id="f9d1a-186">Il existe plusieurs causes possibles :</span><span class="sxs-lookup"><span data-stu-id="f9d1a-186">There are several possible causes:</span></span>

- <span data-ttu-id="f9d1a-187">Le complément est en cours d’exécution sur une plateforme qui ne prend pas en charge l’API `getAccessToken`.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-187">The add-in is running on a platform that does not support the `getAccessToken` API.</span></span> <span data-ttu-id="f9d1a-188">Par exemple, elle n’est pas compatible avec iPad.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-188">For example, it is not supported on iPad.</span></span> <span data-ttu-id="f9d1a-189">Voir également [Ensembles de conditions requises de l’API d’identité](/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-189">See also [Identity API Requirement Sets](/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span></span>
- <span data-ttu-id="f9d1a-190">L’option `forMSGraphAccess` a été transmise à l’appel à `getAccessToken` et l’utilisateur a obtenu le complément à partir d’AppSource.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-190">The `forMSGraphAccess` option was passed in the call to `getAccessToken` and the user obtained the add-in from AppSource.</span></span> <span data-ttu-id="f9d1a-191">Dans ce scénario, l’administrateur du client n’a pas donné son accord au complément pour les étendues Microsoft Graph (autorisations) dont il a besoin.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-191">In this scenario, the tenant admin has not granted consent to the add-in for the Microsoft Graph scopes (permissions) that it needs.</span></span> <span data-ttu-id="f9d1a-192">Le fait de rappeler `getAccessToken` avec le `allowConsentPrompt` ne résoudra pas le problème, car Office est autorisé à inviter l’utilisateur à donner l’autorisation uniquement à l’étendue de `profile` AAD.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-192">Recalling `getAccessToken` with the `allowConsentPrompt` will not solve the problem because Office is allowed to prompt the user for consent to only the AAD `profile` scope.</span></span>

<span data-ttu-id="f9d1a-193">Votre code doit basculer vers un autre système d’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-193">Your code should fall back to an alternate system of user authentication.</span></span>

<span data-ttu-id="f9d1a-194">En développement, le complément est sideloaded dans Outlook et l’option `forMSGraphAccess` a été transmise dans l’appel à `getAccessToken`.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-194">In development, the add-in is sideloaded in Outlook and the `forMSGraphAccess` option was passed in the call to `getAccessToken`.</span></span>

### <a name="50001"></a><span data-ttu-id="f9d1a-195">50001</span><span class="sxs-lookup"><span data-stu-id="f9d1a-195">50001</span></span>

<span data-ttu-id="f9d1a-196">Cette erreur (qui n’est pas spécifique de `getAccessToken`) peut indiquer que le navigateur a mis en cache une ancienne copie des fichiers office.js.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-196">This error (which is not specific to `getAccessToken`) may indicate that the browser has cached an old copy of the office.js files.</span></span> <span data-ttu-id="f9d1a-197">Quand vous développez, effacez le cache du navigateur.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-197">When you are developing, clear the browser's cache.</span></span> <span data-ttu-id="f9d1a-198">Une autre possibilité est que la version d’Office n’est pas assez récente pour prendre en charge l’authentification unique.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-198">Another possibility is that the version of Office is not recent enough to support SSO.</span></span> <span data-ttu-id="f9d1a-199">Dans Windows, la version minimale est 16.0.12215.20006.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-199">On Windows, the minimum version is 16.0.12215.20006.</span></span> <span data-ttu-id="f9d1a-200">Sur Mac, il s’agit de 16.32.19102902.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-200">On Mac, it is 16.32.19102902.</span></span>

<span data-ttu-id="f9d1a-201">Dans un complément de production, celui-ci doit répondre à cette erreur en basculant vers un autre système d’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-201">In a production add-in, the add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="f9d1a-202">Pour plus d’informations, voir [Meilleures Pratiques et Conditions Requises](/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-202">For more information, see [Requirements and Best Practices](/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span></span>

## <a name="errors-on-the-server-side-from-azure-active-directory"></a><span data-ttu-id="f9d1a-203">Erreurs d’Azure Active Directory côté serveur</span><span class="sxs-lookup"><span data-stu-id="f9d1a-203">Errors on the server-side from Azure Active Directory</span></span>

<span data-ttu-id="f9d1a-204">Pour plus d’exemples de la gestion des erreurs décrite dans cette section, reportez-vous aux articles suivants :</span><span class="sxs-lookup"><span data-stu-id="f9d1a-204">For samples of the error-handling described in this section, see:</span></span>
- [<span data-ttu-id="f9d1a-205">Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="f9d1a-205">Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO)
- [<span data-ttu-id="f9d1a-206">Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="f9d1a-206">Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO)

### <a name="conditional-access--multifactor-authentication-errors"></a><span data-ttu-id="f9d1a-207">Erreurs d’accès conditionnel / authentification multifacteur</span><span class="sxs-lookup"><span data-stu-id="f9d1a-207">Conditional access / Multifactor authentication errors</span></span>

<span data-ttu-id="f9d1a-p124">Dans certaines configurations d’identité sur AAD et Office 365, il est possible pour certaines ressources accessibles via Microsoft Graph d’exiger une authentification multifacteur (AMF), même lorsque ce n’est pas le cas de la location Office 365 de l’utilisateur. Lorsqu’AAD reçoit une requête pour obtenir un jeton d’accès à la ressource protégée par AMF via le flux « de la part de », il renvoie au service web de votre complément un message JSON contenant une propriété `claims`. La propriété de revendication comporte des informations sur les facteurs d’authentification supplémentaires nécessaires.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-p124">In certain configurations of identity in AAD and Office 365, it is possible for some resources that are accessible with Microsoft Graph to require multifactor authentication (MFA), even when the user's Office 365 tenancy does not. When AAD receives a request for a token to the MFA-protected resource, via the on-behalf-of flow, it returns to your add-in's web service a JSON message that contains a `claims` property. The claims property has information about what further authentication factors are needed.</span></span>

<span data-ttu-id="f9d1a-211">Votre code doit tester cette propriété `claims`.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-211">Your code should test for this `claims` property.</span></span> <span data-ttu-id="f9d1a-212">En fonction de l’architecture de votre complément, vous pouvez le tester côté client, ou le tester sur le serveur et le relayer sur le client.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-212">Depending on your add-in's architecture, you may test for it on the client-side, or you may test for it on the server-side and relay it to the client.</span></span> <span data-ttu-id="f9d1a-213">Il vous faut ces informations dans le client, car Office gère l’authentification des compléments SSO. Si vous le relayez côté serveur, le message adressé au client peut être une erreur (telle que `500 Server Error` ou `401 Unauthorized`) ou se trouver dans le corps d’une réponse de succès (telle que `200 OK`).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-213">You need this information in the client because Office handles authentication for SSO add-ins. If you relay it from the server-side, the message to the client can be either an error (such as `500 Server Error` or `401 Unauthorized`) or in the body of a success response (such as `200 OK`).</span></span> <span data-ttu-id="f9d1a-214">Dans les deux cas, le rappel (réussite ou échec) de l’appel AJAX de votre code côté client à l’API web de votre complément devra tester cette réponse.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-214">In either case, the (failure or success) callback of your code's client-side AJAX call to your add-in's web API should test for this response.</span></span> 

<span data-ttu-id="f9d1a-215">Quelle que soit votre architecture, si la valeur de revendication a été relayée, votre code doit rappeler `getAccessToken` et transmettre l’option `authChallenge: CLAIMS-STRING-HERE` dans le paramètre `options`.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-215">Regardless of your architexture, if the claims value has been sent from AAD, your code should recall `getAccessToken` and pass the option `authChallenge: CLAIMS-STRING-HERE` in the `options` parameter.</span></span> <span data-ttu-id="f9d1a-216">Lorsqu’AAD voit cette chaîne, il demande le(s) facteur(s) supplémentaire(s) à l’utilisateur, puis renvoie un nouveau jeton d’accès qui sera accepté dans le flux « de la part de ».</span><span class="sxs-lookup"><span data-stu-id="f9d1a-216">When AAD sees this string, it prompts the user for the additional factor(s) and then returns a new access token which will be accepted in the on-behalf-of flow.</span></span>

### <a name="consent-missing-errors"></a><span data-ttu-id="f9d1a-217">Erreurs de consentement manquant</span><span class="sxs-lookup"><span data-stu-id="f9d1a-217">Consent missing errors</span></span>

<span data-ttu-id="f9d1a-218">Si AAD ne détient aucune trace qu’un consentement (à la ressource Microsoft Graph) a été accordé au complément par l’utilisateur (ou administrateur client), AAD envoie un message d’erreur à votre service web.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-218">If AAD has no record that consent (to the Microsoft Graph resource) was granted to the add-in by the user (or tenant administrator), AAD will send an error message to your web service.</span></span> <span data-ttu-id="f9d1a-219">Votre code doit indiquer au client (dans le corps d’une réponse `403 Forbidden`, par exemple).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-219">Your code must tell the client (in the body of a `403 Forbidden` response, for example).</span></span>

<span data-ttu-id="f9d1a-220">Si le complément a besoin d’étendues Microsoft Graph qui ne peuvent être envoyées qu’à un administrateur, votre code doit générer une erreur.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-220">If the add-in needs Microsoft Graph scopes that can only be consented to by an admin, your code should throw an error.</span></span> <span data-ttu-id="f9d1a-221">Si les seules étendues requises peuvent être envoyées par l’utilisateur, votre code doit basculer vers un autre système d’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-221">If the only scopes that are needed can be consented to by the user, then your code should fall back to an alternate system of user authentication.</span></span>

### <a name="invalid-or-missing-scope-permission-errors"></a><span data-ttu-id="f9d1a-222">Erreurs d’étendue (autorisation) non valide ou manquante</span><span class="sxs-lookup"><span data-stu-id="f9d1a-222">Invalid or missing scope (permission) errors</span></span>

<span data-ttu-id="f9d1a-223">Ce type d’erreur ne doit apparaître qu’en développement.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-223">This kind of error should only be seen in development.</span></span>

- <span data-ttu-id="f9d1a-224">Votre code côté serveur doit envoyer une réponse `403 Forbidden` au client qui doit consigner l’erreur dans la console ou l’enregistrer dans un journal.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-224">Your server-side code should send a `403 Forbidden` response to the client which should log the error to the console or record it in a log.</span></span>
- <span data-ttu-id="f9d1a-225">Assurez-vous que la section [Scopes](/office/dev/add-ins/reference/manifest/scopes) du manifeste de votre complément indique toutes les autorisations nécessaires.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-225">Be sure your add-in manifest [Scopes](/office/dev/add-ins/reference/manifest/scopes) section specifies all needed permissions.</span></span> <span data-ttu-id="f9d1a-226">Vérifiez également que l’alignement du service web de votre complément spécifie les mêmes autorisations.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-226">And be sure your registration of the add-in's web service specifies the same permissions.</span></span> <span data-ttu-id="f9d1a-227">Vérifiez les fautes d’orthographe.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-227">Check for spelling mistakes too.</span></span> <span data-ttu-id="f9d1a-228">Pour plus d’informations, voir [Inscrire votre complément avec le point de terminaison Azure AD v2.0](register-sso-add-in-aad-v2.md).</span><span class="sxs-lookup"><span data-stu-id="f9d1a-228">For more information, see [Register the add-in with Azure AD v2.0 endpoint](register-sso-add-in-aad-v2.md).</span></span>

### <a name="invalid-audience-error-in-the-access-token-not-the-bootstrap-token"></a><span data-ttu-id="f9d1a-229">Erreur d’audience non valide dans le jeton d’accès (pas le jeton bootstrap)</span><span class="sxs-lookup"><span data-stu-id="f9d1a-229">Invalid audience error in the access token (not the bootstrap token)</span></span>

<span data-ttu-id="f9d1a-230">Votre code côté serveur doit envoyer une réponse `403 Forbidden` au client, qui doit présenter un message amical à l’utilisateur et éventuellement consigner l’erreur dans la console ou l’enregistrer dans un journal.</span><span class="sxs-lookup"><span data-stu-id="f9d1a-230">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user and possibly also log the error to the console or record it in a log.</span></span>
