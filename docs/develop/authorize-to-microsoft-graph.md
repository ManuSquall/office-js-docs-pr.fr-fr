---
title: Autoriser la connexion à Microsoft Graph avec l’authentification unique
description: Découvrez comment les utilisateurs d’un complément Office peuvent utiliser l’authentification unique (SSO) pour extraire des données de Microsoft Graph.
ms.date: 07/30/2020
localization_priority: Normal
ms.openlocfilehash: 68440a347e11d909f0ebd4d4d29892711646da5e
ms.sourcegitcommit: 9609bd5b4982cdaa2ea7637709a78a45835ffb19
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/28/2020
ms.locfileid: "47292903"
---
# <a name="authorize-to-microsoft-graph-with-sso"></a><span data-ttu-id="89b87-103">Autoriser la connexion à Microsoft Graph avec l’authentification unique</span><span class="sxs-lookup"><span data-stu-id="89b87-103">Authorize to Microsoft Graph with SSO</span></span>

<span data-ttu-id="89b87-104">Les utilisateurs se connectent à Office (plateformes en ligne, mobiles et de bureau) à l’aide de leur compte Microsoft personnel ou de leur compte professionnel ou scolaire Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="89b87-104">Users sign in to Office (online, mobile, and desktop platforms) using either their personal Microsoft account or their Microsoft 365 Education or work account.</span></span> <span data-ttu-id="89b87-105">Le meilleur moyen pour un complément Office d’obtenir un accès autorisé à [Microsoft Graph](https://developer.microsoft.com/graph/docs) est d’utiliser les informations d’identification Office de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="89b87-105">The best way for an Office Add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on.</span></span> <span data-ttu-id="89b87-106">Cela leur permet d’accéder à leurs données Microsoft Graph sans avoir à se connecter une deuxième fois.</span><span class="sxs-lookup"><span data-stu-id="89b87-106">This enables them to access their Microsoft Graph data without needing to sign in a second time.</span></span>

> [!NOTE]
> <span data-ttu-id="89b87-107">La connexion unique sur API est actuellement prise en charge pour Word, Excel et PowerPoint.</span><span class="sxs-lookup"><span data-stu-id="89b87-107">The Single Sign-on API is currently supported for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="89b87-108">Pour plus d’informations sur l’endroit où l’API d’authentification unique est actuellement prise en charge, consultez la rubrique [Ensembles de conditions requises de l’API d’identité](/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span><span class="sxs-lookup"><span data-stu-id="89b87-108">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span></span>
> <span data-ttu-id="89b87-109">Si vous utilisez un complément Outlook, veillez à activer l’authentification moderne pour la location d’Office 365.</span><span class="sxs-lookup"><span data-stu-id="89b87-109">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="89b87-110">Pour plus d’informations sur la manière de procéder, consultez la rubrique [Exchange Online : Activation de votre client pour l’authentification moderne](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="89b87-110">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>


## <a name="add-in-architecture-for-sso-and-microsoft-graph"></a><span data-ttu-id="89b87-111">Architecture de complément pour l’authentification unique et Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="89b87-111">Add-in architecture for SSO and Microsoft Graph</span></span>

<span data-ttu-id="89b87-112">Outre l’hébergement des pages et du JavaScript de l’application Web, le complément doit également héberger, dans le même [nom de domaine complet](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), une ou plusieurs API Web qui recevront un jeton d’accès à Microsoft Graph et effectueront des requêtes.</span><span class="sxs-lookup"><span data-stu-id="89b87-112">In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), one or more web APIs that will get an access token to Microsoft Graph and make requests to it.</span></span>

<span data-ttu-id="89b87-113">Le manifeste du complément contient un balisage qui spécifie comment le complément est enregistré dans le point de terminaison Azure Active Directory (Azure AD) v2.0 et il indique les autorisations à Microsoft Graph dont le complément a besoin.</span><span class="sxs-lookup"><span data-stu-id="89b87-113">The add-in manifest contains markup that specifies how the add-in is registered in the Azure Active Directory (Azure AD) v2.0 endpoint, and it specifies any permissions to Microsoft Graph that the add-in needs.</span></span>

### <a name="how-it-works-at-runtime"></a><span data-ttu-id="89b87-114">Mode de fonctionnement en cours d’exécution</span><span class="sxs-lookup"><span data-stu-id="89b87-114">How it works at runtime</span></span>

<span data-ttu-id="89b87-115">Le diagramme suivant montre comment fonctionne le processus de connexion et l’accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-115">The following diagram shows how the process of signing in and getting access to Microsoft Graph works.</span></span>

![Un diagramme illustrant le processus d’authentification unique](../images/sso-access-to-microsoft-graph.png)

1. <span data-ttu-id="89b87-117">Dans le complément, JavaScript appelle une nouvelle API Office.js [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span><span class="sxs-lookup"><span data-stu-id="89b87-117">In the add-in, JavaScript calls a new Office.js API [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span></span> <span data-ttu-id="89b87-118">Cette option indique à l’application cliente Office d’obtenir un jeton d’accès pour le complément.</span><span class="sxs-lookup"><span data-stu-id="89b87-118">This tells the Office client application to obtain an access token to the add-in.</span></span> <span data-ttu-id="89b87-119">(Ci-après, il est appelé **jeton d’accès bootstrap**, car il est remplacé par un deuxième jeton plus loin dans le processus.</span><span class="sxs-lookup"><span data-stu-id="89b87-119">(Hereafter, this is called the **bootstrap access token** because it is replaced with a second token later in the process.</span></span> <span data-ttu-id="89b87-120">Pour consulter un exemple de jeton d’accès bootstrap décodé, voir [Exemple jeton d’accès](sso-in-office-add-ins.md#example-access-token).)</span><span class="sxs-lookup"><span data-stu-id="89b87-120">For an example of a decoded bootstrap access token, see [Example access token](sso-in-office-add-ins.md#example-access-token).)</span></span>
2. <span data-ttu-id="89b87-121">Si l’utilisateur n’est pas connecté, l’application cliente Office ouvre une fenêtre contextuelle pour que l’utilisateur se connecte.</span><span class="sxs-lookup"><span data-stu-id="89b87-121">If the user is not signed in, the Office client application opens a pop-up window for the user to sign in.</span></span>
3. <span data-ttu-id="89b87-122">Si c’est la première fois que l’utilisateur actuel utilise votre complément, il est invité à donner son consentement.</span><span class="sxs-lookup"><span data-stu-id="89b87-122">If this is the first time the current user has used your add-in, he or she is prompted to consent.</span></span>
4. <span data-ttu-id="89b87-123">L’application cliente Office demande le **jeton d’accès bootstrap** depuis le point de terminaison Azure ad v 2.0 pour l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="89b87-123">The Office client application requests the **bootstrap access token** from the Azure AD v2.0 endpoint for the current user.</span></span>
5. <span data-ttu-id="89b87-124">Azure AD envoie le jeton d’amorçage à l’application cliente Office.</span><span class="sxs-lookup"><span data-stu-id="89b87-124">Azure AD sends the bootstrap token to the Office client application.</span></span>
6. <span data-ttu-id="89b87-125">L’application cliente Office envoie le **jeton d’accès bootstrap** au complément dans le cadre de l’objet de résultat renvoyé par l' `getAccessToken` appel.</span><span class="sxs-lookup"><span data-stu-id="89b87-125">The Office client application sends the **bootstrap access token** to the add-in as part of the result object returned by the `getAccessToken` call.</span></span>
7. <span data-ttu-id="89b87-126">JavaScript dans le complément effectue une requête HTTP à une API web qui est hébergée sur le même domaine complet que le complément et inclut le **jeton d’accès bootstrap** comme preuve d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="89b87-126">JavaScript in the add-in makes an HTTP request to a web API that is hosted at the same fully-qualified domain as the add-in, and it includes the **bootstrap access token** as authorization proof.</span></span>
8. <span data-ttu-id="89b87-127">Le code côté serveur valide le **jeton d’accès bootstrap** entrant.</span><span class="sxs-lookup"><span data-stu-id="89b87-127">Server-side code validates the incoming **bootstrap access token**.</span></span>
9. <span data-ttu-id="89b87-128">Le code côté serveur utilise le flux « de la part de » (défini dans [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) et le [scénario ou l’application serveur vers le scénario Azure de l’API Web](/azure/active-directory/develop/active-directory-authentication-scenarios)) pour obtenir un jeton d’accès pour Microsoft Graph dans Exchange pour le jeton d’accès bootstrap.</span><span class="sxs-lookup"><span data-stu-id="89b87-128">Server-side code uses the "on behalf of" flow (defined at [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) and the [daemon or server application to web API Azure scenario](/azure/active-directory/develop/active-directory-authentication-scenarios)) to obtain an access token for Microsoft Graph in exchange for the bootstrap access token.</span></span>
10. <span data-ttu-id="89b87-129">Azure AD renvoie le jeton d’accès à Microsoft Graph (et un jeton d’actualisation si le complément demande l’autorisation *offline_access*) au complément.</span><span class="sxs-lookup"><span data-stu-id="89b87-129">Azure AD returns the access token to Microsoft Graph (and a refresh token, if the add-in requests *offline_access* permission) to the add-in.</span></span>
11. <span data-ttu-id="89b87-130">Le code côté serveur met en cache le jeton d’accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-130">Server-side code caches the access token to Microsoft Graph.</span></span>
12. <span data-ttu-id="89b87-131">Le code côté serveur effectue des requêtes à Microsoft Graph et inclut le jeton d’accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-131">Server-side code makes requests to Microsoft Graph and includes the access token to Microsoft Graph.</span></span>
13. <span data-ttu-id="89b87-132">Microsoft Graph renvoie des données au complément, qui peuvent le transmettre à l’interface utilisateur du complément.</span><span class="sxs-lookup"><span data-stu-id="89b87-132">Microsoft Graph returns data to the add-in, which can pass it on to the add-in's UI.</span></span>
14. <span data-ttu-id="89b87-133">Lorsque le jeton d’accès à Microsoft Graph expire, le code côté serveur peut utiliser son jeton d’actualisation pour obtenir un nouveau jeton d’accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-133">When the access token to Microsoft Graph expires, the server-side code can use its refresh token to get a new access token to Microsoft Graph.</span></span>

## <a name="develop-an-sso-add-in-that-accesses-microsoft-graph"></a><span data-ttu-id="89b87-134">Développer un complément authentification unique qui accède à Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="89b87-134">Develop an SSO add-in that accesses Microsoft Graph</span></span>

<span data-ttu-id="89b87-135">Vous développez un complément qui accède à Microsoft Graph comme vous le feriez pour n’importe quel autre complément qui utilise l’authentification unique.</span><span class="sxs-lookup"><span data-stu-id="89b87-135">You develop an add-in that accesses Microsoft Graph just as you would any other add-in that uses SSO.</span></span> <span data-ttu-id="89b87-136">Pour obtenir une description complète, voir [Activer l’authentification unique pour les compléments Office](../develop/sso-in-office-add-ins.md). La différence est qu’il est obligatoire que le complément ait une API Web côté serveur, et ce qu’on appelle le jeton d’accès dans cet article s’appelle le « jeton d’accès bootstrap ».</span><span class="sxs-lookup"><span data-stu-id="89b87-136">For a thorough description, see [Enable single sign-on for Office Add-ins](../develop/sso-in-office-add-ins.md). The difference is that it is mandatory that the add-in have a server-side Web API, and what's called the access token in that article is called the "bootstrap access token."</span></span>

<span data-ttu-id="89b87-137">Selon votre langue et votre infrastructure, des bibliothèques peuvent être disponibles pour simplifier le code côté serveur que vous devez rédiger.</span><span class="sxs-lookup"><span data-stu-id="89b87-137">Depending on your language and framework, libraries might be available that will simplify the server-side code you have to write.</span></span> <span data-ttu-id="89b87-138">Votre code côté serveur doit effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="89b87-138">Your code should do the following:</span></span>

* <span data-ttu-id="89b87-139">Lancez le flux « de la part de » avec un appel vers le point de terminaison Azure AD v 2.0 qui inclut le jeton d’accès bootstrap, certaines métadonnées relatives à l’utilisateur et les informations d’identification du complément (son ID et sa clé secrète).</span><span class="sxs-lookup"><span data-stu-id="89b87-139">Initiate the "on behalf of" flow with a call to the Azure AD v2.0 endpoint that includes the bootstrap access token, some metadata about the user, and the credentials of the add-in (its ID and secret).</span></span>
* <span data-ttu-id="89b87-140">Créer une ou plusieurs méthodes API Web qui obtiennent des données de Microsoft Graph en transmettant le jeton d’accès (potentiellement mis en cache) à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-140">Create one or more Web API methods that get Microsoft Graph data by passing the (possibly cached) access token to Microsoft Graph.</span></span>
* <span data-ttu-id="89b87-141">De manière facultative, avant d’initier le flux, validez le jeton d’accès bootstrap reçu à partir du gestionnaire de jetons que vous avez créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="89b87-141">Optionally, before initiating the flow, validate the add-in bootstrap access token that is received from the token handler you created earlier.</span></span> <span data-ttu-id="89b87-142">Pour plus d’informations, voir [Valider le jeton d’accès](sso-in-office-add-ins.md#validate-the-access-token).</span><span class="sxs-lookup"><span data-stu-id="89b87-142">For more information, see [Validate the access token](sso-in-office-add-ins.md#validate-the-access-token).</span></span> 
* <span data-ttu-id="89b87-143">De manière facultative, une fois le flux terminé, mettez en cache le jeton d’accès renvoyé vers Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-143">Optionally, after the flow completes, cache the returned access token to Microsoft Graph.</span></span> <span data-ttu-id="89b87-144">Nous vous conseillons de le faire si le complément effectue plusieurs appels à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-144">You'll want to do this if the add-in makes more than one call to Microsoft Graph.</span></span> <span data-ttu-id="89b87-145">Pour plus d’informations sur ce flux, voir [Azure Active Directory v2.0 et OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="89b87-145">For more information about this flow see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

> [!NOTE]
> <span data-ttu-id="89b87-146">Pour consulter des exemples de jeton d’accès décodés pour Microsoft Graph qui ont été obtenus par le flux « de la part de », voir [Azure Active Directory v2.0 et OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="89b87-146">For examples of decoded access tokens for Microsoft Graph that have been obtained by the "on-behalf-of" flow, see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

<span data-ttu-id="89b87-147">Pour obtenir des exemples de scénarios et procédures détaillées, consultez les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="89b87-147">For examples of detailed walkthroughs and scenarios, see:</span></span>

* [<span data-ttu-id="89b87-148">Créer un complément Office Node.js qui utilise l’authentification unique</span><span class="sxs-lookup"><span data-stu-id="89b87-148">Create a Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)
* [<span data-ttu-id="89b87-149">Créer un complément Office ASP.NET qui utilise l’authentification unique</span><span class="sxs-lookup"><span data-stu-id="89b87-149">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
* [<span data-ttu-id="89b87-150">Scénario : Implémenter l’authentification unique pour votre service dans un complément Outlook</span><span class="sxs-lookup"><span data-stu-id="89b87-150">Scenario: Implement single sign-on to your service in an Outlook add-in</span></span>](../outlook/implement-sso-in-outlook-add-in.md)

## <a name="distributing-sso-enabled-add-ins-in-microsoft-appsource"></a><span data-ttu-id="89b87-151">Distribution de compléments à extension SSO dans Microsoft AppSource</span><span class="sxs-lookup"><span data-stu-id="89b87-151">Distributing SSO-enabled add-ins in Microsoft AppSource</span></span>

<span data-ttu-id="89b87-152">Lorsqu’un administrateur Microsoft 365 acquiert un complément à partir de [AppSource](https://appsource.microsoft.com), l’administrateur peut le redistribuer par [déploiement centralisé](../publish/centralized-deployment.md) et accorder le consentement de l’administrateur au complément pour accéder aux étendues de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-152">When a Microsoft 365 admin acquires an add-in from [AppSource](https://appsource.microsoft.com), the admin can redistribute it by [centralized deployment](../publish/centralized-deployment.md) and grant admin consent to the add-in to access Microsoft Graph scopes.</span></span> <span data-ttu-id="89b87-153">Toutefois, il est également possible pour l’utilisateur final d’acquérir le complément directement à partir de AppSource, auquel cas l’utilisateur doit accorder son consentement au complément.</span><span class="sxs-lookup"><span data-stu-id="89b87-153">It's also possible, however, for the end user to acquire the add-in directly from AppSource, in which case the user must grant consent to the add-in.</span></span> <span data-ttu-id="89b87-154">Cela peut créer un problème de performances potentiel pour lequel nous avons fourni une solution.</span><span class="sxs-lookup"><span data-stu-id="89b87-154">This can create a potential performance problem for which we've provided a solution.</span></span>

<span data-ttu-id="89b87-155">Si votre code transmet l' `allowConsentPrompt` option dans l’appel de `getAccessToken` , par exemple, `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );` Office peut demander à l’utilisateur d’indiquer si Azure ad signale à Office que le consentement n’a pas encore été accordé au complément.</span><span class="sxs-lookup"><span data-stu-id="89b87-155">If your code passes the `allowConsentPrompt` option in the call of `getAccessToken`, like `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );`, then Office can prompt the user for consent if Azure AD reports to Office that consent has not yet been granted to the add-in.</span></span> <span data-ttu-id="89b87-156">Toutefois, pour des raisons de sécurité, Office peut uniquement inviter l’utilisateur à accepter l’étendue Azure AD `profile` .</span><span class="sxs-lookup"><span data-stu-id="89b87-156">However, for security reasons, Office can only prompt the user to consent to the Azure AD `profile` scope.</span></span> <span data-ttu-id="89b87-157">*Office ne peut pas demander l’autorisation de n’importe quelle étendue Microsoft Graph*, pas même `User.Read` .</span><span class="sxs-lookup"><span data-stu-id="89b87-157">*Office cannot prompt for consent to any Microsoft Graph scopes*, not even `User.Read`.</span></span> <span data-ttu-id="89b87-158">Cela signifie que si l’utilisateur accorde son consentement sur l’invite, Office renverra un jeton de démarrage.</span><span class="sxs-lookup"><span data-stu-id="89b87-158">This means that if the user grants consent on the prompt, Office will return a bootstrap token.</span></span> <span data-ttu-id="89b87-159">Toutefois, la tentative d’échange du jeton d’amorçage pour un jeton d’accès à Microsoft Graph échouera avec l’erreur AADSTS65001, ce qui signifie que le consentement (vers les étendues de Microsoft Graph) n’a pas été accordé.</span><span class="sxs-lookup"><span data-stu-id="89b87-159">But the attempt to exchange the bootstrap token for an access token to Microsoft Graph will fail with error AADSTS65001, which means consent (to Microsoft Graph scopes) has not been granted.</span></span>

<span data-ttu-id="89b87-160">Votre code peut et doit gérer cette erreur en revenant à un autre système d’authentification, qui invite l’utilisateur à donner son consentement aux étendues Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-160">Your code can, and should, handle this error by falling back to an alternate system of authentication, which will prompt the user for consent to Microsoft Graph scopes.</span></span> <span data-ttu-id="89b87-161">(Pour obtenir des exemples de code, voir [créer une Node.js complément Office qui utilise l’authentification unique](create-sso-office-add-ins-nodejs.md) et [créer un complément Office ASP.net qui utilise l’authentification unique](create-sso-office-add-ins-aspnet.md) et les exemples auxquels il est lié.) Toutefois, le processus entier nécessite plusieurs allers-retours vers Azure AD.</span><span class="sxs-lookup"><span data-stu-id="89b87-161">(For code examples, see [Create a Node.js Office Add-in that uses single sign-on](create-sso-office-add-ins-nodejs.md) and [Create an ASP.NET Office Add-in that uses single sign-on](create-sso-office-add-ins-aspnet.md) and the samples they link to.) But the entire process requires multiple round trips to Azure AD.</span></span> <span data-ttu-id="89b87-162">Vous pouvez éviter cette perte de performances en incluant l' `forMSGraphAccess` option dans l’appel de `getAccessToken` ; par exemple, `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )` .</span><span class="sxs-lookup"><span data-stu-id="89b87-162">You can avoid this performance penalty by including the `forMSGraphAccess` option in the call of `getAccessToken`; for example, `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )`.</span></span>  <span data-ttu-id="89b87-163">Cela signale à Office que votre complément a besoin des étendues de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-163">This signals to Office that your add-in needs Microsoft Graph scopes.</span></span> <span data-ttu-id="89b87-164">Office demande à Azure AD de vérifier que le consentement vers les étendues de Microsoft Graph a déjà été accordé au complément.</span><span class="sxs-lookup"><span data-stu-id="89b87-164">Office will ask Azure AD to verify that consent to Microsoft Graph scopes has already been granted to the add-in.</span></span> <span data-ttu-id="89b87-165">Si c’est le cas, le jeton bootstrap sera renvoyé.</span><span class="sxs-lookup"><span data-stu-id="89b87-165">If it has, the bootstrap token will be returned.</span></span> <span data-ttu-id="89b87-166">Si ce n’est pas le cas, l’appel de `getAccessToken` renvoie l’erreur 13012.</span><span class="sxs-lookup"><span data-stu-id="89b87-166">If it hasn't, then the call of `getAccessToken` will return error 13012.</span></span> <span data-ttu-id="89b87-167">Votre code peut gérer cette erreur en revenant immédiatement à un autre système d’authentification, sans qu’une Doomed tente d’échanger des jetons avec Azure AD.</span><span class="sxs-lookup"><span data-stu-id="89b87-167">Your code can handle this error by falling back to an alternate system of authentication immediately, without making a doomed attempt to exchange tokens with Azure AD.</span></span>

<span data-ttu-id="89b87-168">Il est recommandé de toujours transmettre `forMSGraphAccess` à `getAccessToken` lorsque votre complément sera distribué dans AppSource et que vous avez besoin des étendues de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89b87-168">As a best practice, always pass `forMSGraphAccess` to `getAccessToken` when your add-in will be distributed in AppSource and needs Microsoft Graph scopes.</span></span>

> [!TIP]
> <span data-ttu-id="89b87-169">Si vous développez un complément Outlook qui utilise l’authentification unique et que vous le chargement à des fins de test, Office renverra *toujours* l’erreur 13012 lorsque `forMSGraphAccess` est passé à `getAccessToken` même si le consentement de l’administrateur a été accordé.</span><span class="sxs-lookup"><span data-stu-id="89b87-169">If you develop an Outlook add-in that uses SSO and you sideload it for testing, Office will *always* return error 13012 when `forMSGraphAccess` is passed to `getAccessToken` even if administrator consent has been granted.</span></span> <span data-ttu-id="89b87-170">Pour cette raison, vous devez commenter l' `forMSGraphAccess` option **lorsque vous développez** un complément Outlook.</span><span class="sxs-lookup"><span data-stu-id="89b87-170">For this reason, you should comment out the `forMSGraphAccess` option **when developing** an Outlook add-in.</span></span> <span data-ttu-id="89b87-171">N’oubliez pas de supprimer les marques de commentaire de l’option lorsque vous déployez pour la production.</span><span class="sxs-lookup"><span data-stu-id="89b87-171">Be sure to uncomment the option when you deploy for production.</span></span> <span data-ttu-id="89b87-172">Les fausses 13012 ne se produisent que lorsque vous êtes chargement dans Outlook.</span><span class="sxs-lookup"><span data-stu-id="89b87-172">The bogus 13012 only happens when you are sideloading in Outlook.</span></span>
