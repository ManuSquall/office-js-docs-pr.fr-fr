---
title: Autoriser la connexion à Microsoft Graph avec l’authentification unique
description: ''
ms.date: 01/14/2020
localization_priority: Normal
ms.openlocfilehash: 77dec8eda1c630bef6277008bef4b129e29a8dae
ms.sourcegitcommit: d15bca2c12732f8599be2ec4b2adc7c254552f52
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/12/2020
ms.locfileid: "41949684"
---
# <a name="authorize-to-microsoft-graph-with-sso-preview"></a><span data-ttu-id="6dc56-102">Autoriser la connexion à Microsoft Graph avec l’authentification unique (préversion)</span><span class="sxs-lookup"><span data-stu-id="6dc56-102">Authorize to Microsoft Graph with SSO (preview)</span></span>

<span data-ttu-id="6dc56-103">Les utilisateurs se connectent à Office (plateformes en ligne, mobiles et de bureau) à l’aide de leur compte Microsoft personnel ou de leur compte professionnel ou scolaire (Office 365).</span><span class="sxs-lookup"><span data-stu-id="6dc56-103">Users sign in to Office (online, mobile, and desktop platforms) using either their personal Microsoft account or their work or school (Office 365) account.</span></span> <span data-ttu-id="6dc56-104">Le meilleur moyen pour un complément Office d’obtenir un accès autorisé à [Microsoft Graph](https://developer.microsoft.com/graph/docs) est d’utiliser les informations d’identification Office de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="6dc56-104">The best way for an Office Add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on.</span></span> <span data-ttu-id="6dc56-105">Cela leur permet d’accéder à leurs données Microsoft Graph sans avoir à se connecter une deuxième fois.</span><span class="sxs-lookup"><span data-stu-id="6dc56-105">This enables them to access their Microsoft Graph data without needing to sign in a second time.</span></span> 

> [!NOTE]
> <span data-ttu-id="6dc56-p102">L’API de l’authentification unique est actuellement prise en charge en mode aperçu pour Word, Excel, Outlook et PowerPoint. Pour plus d’informations sur l’endroit où l’API d’authentification unique est actuellement prise en charge, consultez la rubrique [Ensembles de conditions requises de l’API d’identité](/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets). Si vous utilisez un complément Outlook, veillez à activer l’authentification moderne pour la location d’Office 365. Pour plus d’informations sur la manière de procéder, consultez la rubrique [Exchange Online : Activation de votre client pour l’authentification moderne](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="6dc56-p102">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint. For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets). If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy. For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="add-in-architecture-for-sso-and-microsoft-graph"></a><span data-ttu-id="6dc56-110">Architecture de complément pour l’authentification unique et Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="6dc56-110">Add-in architecture for SSO and Microsoft Graph</span></span>

<span data-ttu-id="6dc56-111">Outre l’hébergement des pages et du JavaScript de l’application Web, le complément doit également héberger, dans le même [nom de domaine complet](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), une ou plusieurs API Web qui recevront un jeton d’accès à Microsoft Graph et effectueront des requêtes.</span><span class="sxs-lookup"><span data-stu-id="6dc56-111">In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), one or more web APIs that will get an access token to Microsoft Graph and make requests to it.</span></span>

<span data-ttu-id="6dc56-112">Le manifeste du complément contient un balisage qui spécifie comment le complément est enregistré dans le point de terminaison Azure Active Directory (Azure AD) v2.0 et il indique les autorisations à Microsoft Graph dont le complément a besoin.</span><span class="sxs-lookup"><span data-stu-id="6dc56-112">The add-in manifest contains markup that specifies how the add-in is registered in the Azure Active Directory (Azure AD) v2.0 endpoint, and it specifies any permissions to Microsoft Graph that the add-in needs.</span></span>

### <a name="how-it-works-at-runtime"></a><span data-ttu-id="6dc56-113">Mode de fonctionnement en cours d’exécution</span><span class="sxs-lookup"><span data-stu-id="6dc56-113">How it works at runtime</span></span>

<span data-ttu-id="6dc56-114">Le diagramme suivant montre comment fonctionne le processus de connexion et l’accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6dc56-114">The following diagram shows how the process of signing in and getting access to Microsoft Graph works.</span></span>

![Un diagramme illustrant le processus d’authentification unique](../images/sso-access-to-microsoft-graph.png)

1. <span data-ttu-id="6dc56-116">Dans le complément, JavaScript appelle une nouvelle API Office.js [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span><span class="sxs-lookup"><span data-stu-id="6dc56-116">In the add-in, JavaScript calls a new Office.js API [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span></span> <span data-ttu-id="6dc56-117">Cela indique à l’application hôte Office qu’elle doit obtenir un jeton d’accès au complément.</span><span class="sxs-lookup"><span data-stu-id="6dc56-117">This tells the Office host application to obtain an access token to the add-in.</span></span> <span data-ttu-id="6dc56-118">(Ci-après, il est appelé **jeton d’accès bootstrap**, car il est remplacé par un deuxième jeton plus loin dans le processus.</span><span class="sxs-lookup"><span data-stu-id="6dc56-118">(Hereafter, this is called the **bootstrap access token** because it is replaced with a second token later in the process.</span></span> <span data-ttu-id="6dc56-119">Pour consulter un exemple de jeton d’accès bootstrap décodé, voir [Exemple jeton d’accès](sso-in-office-add-ins.md#example-access-token).)</span><span class="sxs-lookup"><span data-stu-id="6dc56-119">For an example of a decoded bootstrap access token, see [Example access token](sso-in-office-add-ins.md#example-access-token).)</span></span>
2. <span data-ttu-id="6dc56-120">Si l’utilisateur n’est pas connecté, l’application hôte Office ouvre une fenêtre contextuelle pour que l’utilisateur se connecte.</span><span class="sxs-lookup"><span data-stu-id="6dc56-120">If the user is not signed in, the Office host application opens a pop-up window for the user to sign in.</span></span>
3. <span data-ttu-id="6dc56-121">Si c’est la première fois que l’utilisateur actuel utilise votre complément, il est invité à donner son consentement.</span><span class="sxs-lookup"><span data-stu-id="6dc56-121">If this is the first time the current user has used your add-in, he or she is prompted to consent.</span></span>
4. <span data-ttu-id="6dc56-122">L’application hôte Office demande le **jeton d’accès bootstrap** au point de terminaison Azure AD v2.0 pour l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="6dc56-122">The Office host application requests the **bootstrap access token** from the Azure AD v2.0 endpoint for the current user.</span></span>
5. <span data-ttu-id="6dc56-123">Azure AD envoie le jeton bootstrap à l’application hôte Office.</span><span class="sxs-lookup"><span data-stu-id="6dc56-123">Azure AD sends the bootstrap token to the Office host application.</span></span>
6. <span data-ttu-id="6dc56-124">L’application hôte Office envoie le**jeton d’accès bootstrap** au complément dans le cadre de l’objet de résultat renvoyé par l’appel`getAccessToken`.</span><span class="sxs-lookup"><span data-stu-id="6dc56-124">The Office host application sends the **bootstrap access token** to the add-in as part of the result object returned by the `getAccessToken` call.</span></span>
7. <span data-ttu-id="6dc56-125">JavaScript dans le complément effectue une requête HTTP à une API web qui est hébergée sur le même domaine complet que le complément et inclut le **jeton d’accès bootstrap** comme preuve d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="6dc56-125">JavaScript in the add-in makes an HTTP request to a web API that is hosted at the same fully-qualified domain as the add-in, and it includes the **bootstrap access token** as authorization proof.</span></span>
8. <span data-ttu-id="6dc56-126">Le code côté serveur valide le **jeton d’accès bootstrap** entrant.</span><span class="sxs-lookup"><span data-stu-id="6dc56-126">Server-side code validates the incoming **bootstrap access token**.</span></span>
9. <span data-ttu-id="6dc56-127">Le code côté serveur utilise le flux « de la part de » (défini dans [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) et l’[application démon ou serveur dans un scénario Azure avec une API web](/azure/active-directory/develop/active-directory-authentication-scenarios)) pour obtenir un jeton d’accès à Microsoft Graph en échange du jeton d’accès bootstrap.</span><span class="sxs-lookup"><span data-stu-id="6dc56-127">Server-side code uses the “on behalf of” flow (defined at [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) and the [daemon or server application to web API Azure scenario](/azure/active-directory/develop/active-directory-authentication-scenarios)) to obtain an access token for Microsoft Graph in exchange for the bootstrap access token.</span></span>
10. <span data-ttu-id="6dc56-128">Azure AD renvoie le jeton d’accès à Microsoft Graph (et un jeton d’actualisation si le complément demande l’autorisation *offline_access*) au complément.</span><span class="sxs-lookup"><span data-stu-id="6dc56-128">Azure AD returns the access token to Microsoft Graph (and a refresh token, if the add-in requests *offline_access* permission) to the add-in.</span></span>
11. <span data-ttu-id="6dc56-129">Le code côté serveur met en cache le jeton d’accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6dc56-129">Server-side code caches the access token to Microsoft Graph.</span></span>
12. <span data-ttu-id="6dc56-130">Le code côté serveur effectue des requêtes à Microsoft Graph et inclut le jeton d’accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6dc56-130">Server-side code makes requests to Microsoft Graph and includes the access token to Microsoft Graph.</span></span>
13. <span data-ttu-id="6dc56-131">Microsoft Graph renvoie des données au complément, qui peut les transmettre à l’interface utilisateur du complément.</span><span class="sxs-lookup"><span data-stu-id="6dc56-131">Microsoft Graph returns data to the add-in, which can pass it on to the add-in’s UI.</span></span>
14. <span data-ttu-id="6dc56-132">Lorsque le jeton d’accès à Microsoft Graph expire, le code côté serveur peut utiliser son jeton d’actualisation pour obtenir un nouveau jeton d’accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6dc56-132">When the access token to Microsoft Graph expires, the server-side code can use its refresh token to get a new access token to Microsoft Graph.</span></span>

## <a name="develop-an-sso-add-in-that-accesses-microsoft-graph"></a><span data-ttu-id="6dc56-133">Développer un complément authentification unique qui accède à Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="6dc56-133">Develop an SSO add-in that accesses Microsoft Graph</span></span>

<span data-ttu-id="6dc56-134">Vous développez un complément qui accède à Microsoft Graph comme vous le feriez pour n’importe quel autre complément qui utilise l’authentification unique.</span><span class="sxs-lookup"><span data-stu-id="6dc56-134">You develop an add-in that accesses Microsoft Graph just as you would any other add-in that uses SSO.</span></span> <span data-ttu-id="6dc56-135">Pour obtenir une description complète, voir [Activer l’authentification unique pour les compléments Office](/office/dev/add-ins/develop/sso-in-office-add-ins). La différence est qu’il est obligatoire que le complément ait une API Web côté serveur, et ce qu’on appelle le jeton d’accès dans cet article s’appelle le « jeton d’accès bootstrap ».</span><span class="sxs-lookup"><span data-stu-id="6dc56-135">For a thorough description, see [Enable single sign-on for Office Add-ins](/office/dev/add-ins/develop/sso-in-office-add-ins). The difference is that it is mandatory that the add-in have a server-side Web API, and what's called the access token in that article is called the "bootstrap access token."</span></span>

<span data-ttu-id="6dc56-136">Selon votre langue et votre infrastructure, des bibliothèques peuvent être disponibles pour simplifier le code côté serveur que vous devez rédiger.</span><span class="sxs-lookup"><span data-stu-id="6dc56-136">Depending on your language and framework, libraries might be available that will simplify the server-side code you have to write.</span></span> <span data-ttu-id="6dc56-137">Votre code côté serveur doit effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="6dc56-137">Your code should do the following:</span></span>

* <span data-ttu-id="6dc56-138">Démarrer le flux « de la part de » avec un appel du point de terminaison Azure AD v2.0 qui inclut le jeton d’accès bootstrap, certaines métadonnées relatives à l’utilisateur et les informations d’identification du complément (ID et code secret).</span><span class="sxs-lookup"><span data-stu-id="6dc56-138">Initiate the “on behalf of” flow with a call to the Azure AD v2.0 endpoint that includes the bootstrap access token, some metadata about the user, and the credentials of the add-in (its ID and secret).</span></span>
* <span data-ttu-id="6dc56-139">Créer une ou plusieurs méthodes API Web qui obtiennent des données de Microsoft Graph en transmettant le jeton d’accès (potentiellement mis en cache) à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6dc56-139">Create one or more Web API methods that get Microsoft Graph data by passing the (possibly cached) access token to Microsoft Graph.</span></span>
* <span data-ttu-id="6dc56-140">De manière facultative, avant d’initier le flux, validez le jeton d’accès bootstrap reçu à partir du gestionnaire de jetons que vous avez créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="6dc56-140">Optionally, before initiating the flow, validate the add-in bootstrap access token that is received from the token handler you created earlier.</span></span> <span data-ttu-id="6dc56-141">Pour plus d’informations, voir [Valider le jeton d’accès](sso-in-office-add-ins.md#validate-the-access-token).</span><span class="sxs-lookup"><span data-stu-id="6dc56-141">For more information, see [Validate the access token](sso-in-office-add-ins.md#validate-the-access-token).</span></span> 
* <span data-ttu-id="6dc56-142">De manière facultative, une fois le flux terminé, mettez en cache le jeton d’accès renvoyé vers Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6dc56-142">Optionally, after the flow completes, cache the returned access token to Microsoft Graph.</span></span> <span data-ttu-id="6dc56-143">Nous vous conseillons de le faire si le complément effectue plusieurs appels à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6dc56-143">You'll want to do this if the add-in makes more than one call to Microsoft Graph.</span></span> <span data-ttu-id="6dc56-144">Pour plus d’informations sur ce flux, voir [Azure Active Directory v2.0 et OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="6dc56-144">For more information about this flow see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

> [!NOTE]
> <span data-ttu-id="6dc56-145">Pour consulter des exemples de jeton d’accès décodés pour Microsoft Graph qui ont été obtenus par le flux « de la part de », voir [Azure Active Directory v2.0 et OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="6dc56-145">For examples of decoded access tokens for Microsoft Graph that have been obtained by the "on-behalf-of" flow, see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

<span data-ttu-id="6dc56-146">Pour obtenir des exemples de scénarios et procédures détaillées, consultez les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="6dc56-146">For examples of detailed walkthroughs and scenarios, see:</span></span>

* [<span data-ttu-id="6dc56-147">Créer un complément Office Node.js qui utilise l’authentification unique</span><span class="sxs-lookup"><span data-stu-id="6dc56-147">Create a Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)
* [<span data-ttu-id="6dc56-148">Créer un complément Office ASP.NET qui utilise l’authentification unique</span><span class="sxs-lookup"><span data-stu-id="6dc56-148">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
* [<span data-ttu-id="6dc56-149">Scénario : Implémenter l’authentification unique pour votre service dans un complément Outlook</span><span class="sxs-lookup"><span data-stu-id="6dc56-149">Scenario: Implement single sign-on to your service in an Outlook add-in</span></span>](/outlook/add-ins/implement-sso-in-outlook-add-in)
