---
title: Autoriser Microsoft Graph dans votre complément Office
description: ''
ms.date: 04/10/2018
ms.openlocfilehash: 6d0b6f2002b71c4680b72d2f40492fff1abf15e2
ms.sourcegitcommit: c53f05bbd4abdfe1ee2e42fdd4f82b318b363ad7
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/12/2018
ms.locfileid: "25505858"
---
# <a name="authorize-to-microsoft-graph-in-your-office-add-in-preview"></a><span data-ttu-id="89da6-102">Autorisez Microsoft Graph dans votre complément Office (préversion)</span><span class="sxs-lookup"><span data-stu-id="89da6-102">Authorize to Microsoft Graph in your Office Add-in (preview)</span></span>

<span data-ttu-id="89da6-103">Les utilisateurs se connectent à Office (plateformes en ligne, mobiles et de bureau) à l’aide de leur compte Microsoft personnel ou de leur compte professionnel ou scolaire (Office 365).</span><span class="sxs-lookup"><span data-stu-id="89da6-103">Users sign in to Office (online, mobile, and desktop platforms) using either their personal Microsoft account or their work or school (Office 365) account.</span></span> <span data-ttu-id="89da6-104">Le meilleur moyen pour un complément Office d'obtenir un accès autorisé à [Microsoft Graph](https://developer.microsoft.com/graph/docs) est d'utiliser les informations d'identification de connexion Office de l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="89da6-104">The best way for an Office Add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on.</span></span> <span data-ttu-id="89da6-105">Cela leur permet d’accéder à leurs données Microsoft Graph sans avoir besoin de se connecter une seconde fois.</span><span class="sxs-lookup"><span data-stu-id="89da6-105">This enables them to access their Microsoft Graph data without needing to sign in a second time.</span></span> 

> [!NOTE]
> <span data-ttu-id="89da6-p102">L’API d’authentification unique est actuellement prise en charge en mode préversion pour Word, Excel, Outlook et PowerPoint. Pour plus d’informations sur la prise en charge de l’API d’authentification unique reportez-vous à [Ensembles de conditions requises d’IdentityAPI](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets?view=office-js). Si vous utilisez un complément Outlook, veillez à activer l’authentification moderne pour la location d’Office 365. Pour plus d’informations sur la manière de procéder, consultez la rubrique [Exchange Online : activation de votre client pour l’authentification moderne](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="89da6-p102">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint. For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets?view=office-js). If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy. For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="add-in-architecture-for-sso-and-microsoft-graph"></a><span data-ttu-id="89da6-110">Architecture de complément pour SSO et Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="89da6-110">Add-in architecture for SSO and Microsoft Graph</span></span>

<span data-ttu-id="89da6-111">Outre l’hébergement des pages et du JavaScript de l’application Web, le complément doit également héberger, dans le même [nom de domaine complet](https://docs.microsoft.com/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), une ou plusieurs API Web qui recevront un jeton d’accès à Microsoft Graph et effectueront des requêtes.</span><span class="sxs-lookup"><span data-stu-id="89da6-111">In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name](https://docs.microsoft.com/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), one or more web APIs that will get an access token to Microsoft Graph and make requests to it.</span></span>

<span data-ttu-id="89da6-112">Le manifeste du complément contient un balisage qui spécifie comment le complément est enregistré dans le point de terminaison Azure Active Directory (Azure AD) v2.0 et il indique les autorisations à Microsoft Graph dont le complément a besoin.</span><span class="sxs-lookup"><span data-stu-id="89da6-112">The add-in manifest contains markup that specifies how the add-in is registered in the Azure Active Directory (Azure AD) v2.0 endpoint, and it specifies any permissions to Microsoft Graph that the add-in needs.</span></span>

### <a name="how-it-works-at-runtime"></a><span data-ttu-id="89da6-113">Fonctionnement à l’exécution</span><span class="sxs-lookup"><span data-stu-id="89da6-113">How it works at runtime</span></span>

<span data-ttu-id="89da6-114">Le diagramme suivant montre le fonctionnement du processus de connexion et d'accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89da6-114">The following diagram shows how the process of signing in and getting access to Microsoft Graph works.</span></span>

![Diagramme illustrant le processus d’authentification unique](../images/sso-access-to-microsoft-graph.png)

1. <span data-ttu-id="89da6-p103">Dans le complément, JavaScript appelle une nouvelle API Office.js [getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference). Cette option indique à l’application hôte Office qu'il faut obtenir un jeton d’accès pour le complément (ci-après, il s’agit du **jeton d’accès des données d’amorçage** , car il est remplacé par un deuxième jeton plus loin dans le processus. Pour obtenir un exemple d’un jeton d’accès d’amorçage décodé, voir [Exemple de jeton d’accès](sso-in-office-add-ins.md#example-access-token).)</span><span class="sxs-lookup"><span data-stu-id="89da6-p103">In the add-in, JavaScript calls a new Office.js API [getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference). This tells the Office host application to obtain an access token to the add-in. (Hereafter, this is called the **bootstrap access token** because it is replaced with a second token later in the process. For an example of a decoded bootstrap access token, see [Example access token](sso-in-office-add-ins.md#example-access-token).)</span></span>
1. <span data-ttu-id="89da6-120">Si l’utilisateur n’est pas connecté, l’application hôte Office ouvre une fenêtre contextuelle pour que l’utilisateur se connecte.</span><span class="sxs-lookup"><span data-stu-id="89da6-120">If the user is not signed in, the Office host application opens a pop-up window for the user to sign in.</span></span>
1. <span data-ttu-id="89da6-121">Si c’est la première fois que l’utilisateur utilise votre complément, il est invité à donner son consentement.</span><span class="sxs-lookup"><span data-stu-id="89da6-121">If this is the first time the current user has used your add-in, he or she is prompted to consent.</span></span>
1. <span data-ttu-id="89da6-122">L’application hôte Office demande le **jeton d'accès de démarrage** au point de terminaison Azure AD version 2.0 pour l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="89da6-122">The Office host application requests the **add-in token** from the Azure AD v2.0 endpoint for the current user.</span></span>
1. <span data-ttu-id="89da6-123">Azure AD envoie le jeton de démarrage à l’application hôte Office.</span><span class="sxs-lookup"><span data-stu-id="89da6-123">Azure AD sends the add-in token to the Office host application.</span></span>
1. <span data-ttu-id="89da6-124">L’application hôte Office envoie le **jeton d'accès de démarrage** au complément en tant que partie de l’objet résultat renvoyé par l’appel `getAccessTokenAsync`.</span><span class="sxs-lookup"><span data-stu-id="89da6-124">The Office host application sends the **add-in token** to the add-in as part of the result object returned by the `getAccessTokenAsync` call.</span></span>
1. <span data-ttu-id="89da6-125">Un code JavaScript dans le complément effectue une requête HTTP vers une API web hébergée sur le même domaine complet que le complément et inclut le **jeton d'accès de démarrage** comme preuve d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="89da6-125">JavaScript in the add-in makes an HTTP request to a web API that is hosted at the same fully-qualified domain as the add-in, and it includes the **add-in token** as authorization proof.</span></span>  
1. <span data-ttu-id="89da6-126">Le code côté serveur valide le **jeton d'accès de démarrage**entrant.</span><span class="sxs-lookup"><span data-stu-id="89da6-126">Server-side code validates the incoming **add-in token**.</span></span>
1. <span data-ttu-id="89da6-127">Le code côté serveur utilise le flux « au nom de » (défini par l'[Échange de jetons OAuth2](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) et l'[application démon ou serveur pour un scénario d'API Web Azure](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-scenarios#daemon-or-server-application-to-web-api)) pour obtenir un jeton d'accès pour Microsoft Graph en échange du jeton d'accès de démarrage.</span><span class="sxs-lookup"><span data-stu-id="89da6-127">Server-side code uses the “on behalf of” flow (defined at [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) and the [daemon or server application to web API Azure scenario](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-scenarios#daemon-or-server-application-to-web-api)) to obtain an access token for Microsoft Graph (hereafter, the "MSG token") in exchange for the add-in token.</span></span>
1. <span data-ttu-id="89da6-128">Azure AD renvoie le jeton d'accès à Microsoft Graph (et un jeton d’actualisation si le complément demande l’autorisation *offline_access*) au complément.</span><span class="sxs-lookup"><span data-stu-id="89da6-128">Azure AD returns the MSG token (and a refresh token, if the add-in requests offline_access permission) to the add-in.</span></span>
1. <span data-ttu-id="89da6-129">Le code côté serveur met en cache le jeton d'accès pour Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89da6-129">Server-side code caches the access token to Microsoft Graph.</span></span>
1. <span data-ttu-id="89da6-130">Le code côté serveur envoie des requêtes à Microsoft Graph et inclut le jeton d'accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89da6-130">Server-side code makes requests to Microsoft Graph and includes the MSG token.</span></span>
1. <span data-ttu-id="89da6-131">Microsoft Graph renvoie des données au complément, qui peut les transmettre à l’interface utilisateur du complément.</span><span class="sxs-lookup"><span data-stu-id="89da6-131">Microsoft Graph returns data to the add-in, which can pass it on to the add-in’s UI.</span></span>
1. <span data-ttu-id="89da6-132">Lorsque le jeton d'accès à Microsoft Graph expire, le code côté serveur peut utiliser son jeton d'actualisation pour obtenir un nouveau jeton d'accès à Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89da6-132">When the access token to Microsoft Graph expires, the server-side code can use its refresh token to get a new access token to Microsoft Graph.</span></span>

## <a name="develop-an-sso-add-in-that-accesses-microsoft-graph"></a><span data-ttu-id="89da6-133">Développer un complément SSO qui accède à Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="89da6-133">Develop an SSO add-in that accesses Microsoft Graph</span></span>

<span data-ttu-id="89da6-p104">Vous développez un complément qui accède à Microsoft Graph, de la même façon que le feriez pour n’importe quel autre complément qui utilise l’authentification unique. Pour obtenir une description détaillée, voir [Activer l’authentification unique pour les compléments Office](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins). La différence est qu’il est obligatoire que le complément ait une API de Web côté serveur, et ce qu’on appelle le jeton d’accès appelé, dans cet article, le « jeton d’accès d’amorçage ».</span><span class="sxs-lookup"><span data-stu-id="89da6-p104">You develop an add-in that accesses Microsoft Graph just as you would any other add-in that uses SSO. For a thorough description, see [Enable single sign-on for Office Add-ins](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins). The difference is that it is mandatory that the add-in have a server-side Web API, and what's called the access token in that article is called the "bootstrap access token."</span></span> 

<span data-ttu-id="89da6-p105">Selon votre langage et votre infrastructure, des bibliothèques peuvent être disponibles pour simplifier le code côté serveur que vous devez écrire. Votre code doit effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="89da6-p105">Depending on your language and framework, libraries might be available that will simplify the server-side code you have to write. Your code should do the following:</span></span>

* <span data-ttu-id="89da6-p106">Valider le jeton d’accès d’amorçage de complément qui est reçu à partir du gestionnaire de jeton que vous avez créé précédemment. Pour plus d’informations, voir [Valider le jeton d’accès](sso-in-office-add-ins.md#validate-the-access-token).</span><span class="sxs-lookup"><span data-stu-id="89da6-p106">Validate the add-in bootstrap access token that is received from the token handler you created earlier. For more information, see [Validate the access token](sso-in-office-add-ins.md#validate-the-access-token).</span></span> 
* <span data-ttu-id="89da6-140">Démarrer le flux « de la part de » avec un appel au point de terminaison Azure AD version 2.0 qui inclut le jeton d’accès d’amorçage, certaines métadonnées relatives à l’utilisateur et les informations d’identification du complément (ID et secret).</span><span class="sxs-lookup"><span data-stu-id="89da6-140">Initiate the “on behalf of” flow with a call to the Azure AD v2.0 endpoint that includes the add-in access token, some metadata about the user, and the credentials of the add-in (its ID and secret).</span></span>
* <span data-ttu-id="89da6-p107">Mettre en cache le jeton d’accès renvoyé à Microsoft Graph. Pour plus d’informations sur ce flux voir [Azure Active Directory v2.0  et flux OAuth 2.0  « de la part de »](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="89da6-p107">Cache the returned access token to Microsoft Graph. For more information about this flow see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>
* <span data-ttu-id="89da6-143">Créer une ou plusieurs méthodes d’API Web qui obtiennent des données Microsoft Graph, en transmettant le jeton d’accès mis en cache vers Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="89da6-143">Create one or more Web API methods that get Microsoft Graph data by passing the cached access token to Microsoft Graph.</span></span>

> [!NOTE]
> <span data-ttu-id="89da6-144">Pour des exemples de jetons d'accès décodés pour Microsoft Graph qui ont été obtenus « de la part du » flux, consultez la rubrique [Azure Active Directory version 2.0 et OAuth 2.0 de la part du lux](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="89da6-144">For examples of decoded access tokens for Microsoft Graph that have been obtained by the "on-behalf-of" flow, see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

<span data-ttu-id="89da6-145">Pour une aide détaillée pas à pas et des exemples de scénarios, consultez les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="89da6-145">For examples of detailed walkthroughs, see:</span></span>

* [<span data-ttu-id="89da6-146">Créer un complément Office Node.js qui utilise l’authentification unique</span><span class="sxs-lookup"><span data-stu-id="89da6-146">Create a Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)
* [<span data-ttu-id="89da6-147">Créer un complément Office ASP.NET qui utilise l’authentification unique</span><span class="sxs-lookup"><span data-stu-id="89da6-147">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
* [<span data-ttu-id="89da6-148">Scénario : implémenter l’authentification unique sur votre service dans un complément Outlook</span><span class="sxs-lookup"><span data-stu-id="89da6-148">Scenario: Implement single sign-on to your service in an Outlook Add-in</span></span>](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in)



