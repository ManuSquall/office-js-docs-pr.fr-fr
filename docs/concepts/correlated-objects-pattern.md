---
title: Éviter d’utiliser la méthode context.sync dans des boucles
description: Découvrez comment utiliser la boucle fractionée et les modèles d’objets corrélés pour éviter d’appeler context.sync dans une boucle.
ms.date: 07/29/2020
localization_priority: Normal
ms.openlocfilehash: 64cfd5cd350746ba07e1a98986a4bd7811431475
ms.sourcegitcommit: 883f71d395b19ccfc6874a0d5942a7016eb49e2c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/09/2021
ms.locfileid: "53349139"
---
# <a name="avoid-using-the-contextsync-method-in-loops"></a><span data-ttu-id="d9e76-103">Éviter d’utiliser la méthode context.sync dans des boucles</span><span class="sxs-lookup"><span data-stu-id="d9e76-103">Avoid using the context.sync method in loops</span></span>

> [!NOTE]
> <span data-ttu-id="d9e76-104">Cet article suppose que vous n’êtes pas au début de l’utilisation d’au moins l’une des quatre API JavaScript Office propres à l’application pour Excel, Word, OneNote et Visio qui utilisent un système de traitement par lots pour interagir avec le &mdash; &mdash; document Office.</span><span class="sxs-lookup"><span data-stu-id="d9e76-104">This article assumes that you're beyond the beginning stage of working with at least one of the four application-specific Office JavaScript APIs&mdash;for Excel, Word, OneNote, and Visio&mdash;that use a batch system to interact with the Office document.</span></span> <span data-ttu-id="d9e76-105">En particulier, vous devez savoir ce que fait un appel et ce qu’est `context.sync` un objet de collection.</span><span class="sxs-lookup"><span data-stu-id="d9e76-105">In particular, you should know what a call of `context.sync` does and you should know what a collection object is.</span></span> <span data-ttu-id="d9e76-106">Si vous n’en êtes pas à ce stade, commencez par comprendre [l’API JavaScript Office](../develop/understanding-the-javascript-api-for-office.md) et la documentation liée sous « spécifique à l’application » dans cet article.</span><span class="sxs-lookup"><span data-stu-id="d9e76-106">If you're not at that stage, please start with [Understanding the Office JavaScript API](../develop/understanding-the-javascript-api-for-office.md) and the documentation linked to under "application-specific" in that article.</span></span>

<span data-ttu-id="d9e76-107">Pour certains scénarios de programmation dans les applications Office qui utilisent l’un des modèles d’API propres à l’application (pour Excel, Word, OneNote et Visio), votre code doit lire, écrire ou traiter une propriété de chaque membre d’un objet de collection.</span><span class="sxs-lookup"><span data-stu-id="d9e76-107">For some programming scenarios in Office Add-ins that use one of the application-specific API models (for Excel, Word, OneNote, and Visio), your code needs to read, write, or process some property from every member of a collection object.</span></span> <span data-ttu-id="d9e76-108">Par exemple, un Excel qui a besoin d’obtenir les valeurs de chaque cellule d’une colonne de tableau particulière ou d’un add-in Word qui doit mettre en surbrillement chaque instance d’une chaîne dans le document.</span><span class="sxs-lookup"><span data-stu-id="d9e76-108">For example, an Excel add-in that needs to get the values of every cell in a particular table column or a Word add-in that needs to highlight every instance of a string in the document.</span></span> <span data-ttu-id="d9e76-109">Vous devez itérer sur les membres de la propriété de l’objet de collection, mais, pour des raisons de performances, vous devez éviter d’appeler chaque itération de `items` `context.sync` la boucle.</span><span class="sxs-lookup"><span data-stu-id="d9e76-109">You need to iterate over the members in the `items` property of the collection object; but, for performance reasons, you need to avoid calling `context.sync` in every iteration of the loop.</span></span> <span data-ttu-id="d9e76-110">Chaque appel est un aller-retour entre le Office `context.sync` document.</span><span class="sxs-lookup"><span data-stu-id="d9e76-110">Every call of `context.sync` is a round trip from the add-in to the Office document.</span></span> <span data-ttu-id="d9e76-111">Les allers-retours répétés nuit aux performances, en particulier si le Office sur le Web est en cours d’exécution, car les allers-retours traversent Internet.</span><span class="sxs-lookup"><span data-stu-id="d9e76-111">Repeated round trips hurt performance, especially if the add-in is running in Office on the web because the round trips go across the internet.</span></span>

> [!NOTE]
> <span data-ttu-id="d9e76-112">Tous les exemples de cet article utilisent des boucles, mais les pratiques décrites s’appliquent à n’importe quelle instruction de boucle qui peut itérer dans un tableau, notamment les `for` suivantes :</span><span class="sxs-lookup"><span data-stu-id="d9e76-112">All examples in this article use `for` loops but the practices described apply to any loop statement that can iterate through an array, including the following:</span></span>
>
> - `for`
> - `for of`
> - `while`
> - `do while`
> 
> <span data-ttu-id="d9e76-113">Elles s’appliquent également à toute méthode de tableau à laquelle une fonction est passée et appliquée aux éléments du tableau, notamment :</span><span class="sxs-lookup"><span data-stu-id="d9e76-113">They also apply to any array method to which a function is passed and applied to the items in the array, including the following:</span></span>
>
> - `Array.every`
> - `Array.forEach`
> - `Array.filter`
> - `Array.find`
> - `Array.findIndex`
> - `Array.map`
> - `Array.reduce`
> - `Array.reduceRight`
> - `Array.some`

## <a name="writing-to-the-document"></a><span data-ttu-id="d9e76-114">Écriture dans le document</span><span class="sxs-lookup"><span data-stu-id="d9e76-114">Writing to the document</span></span>

<span data-ttu-id="d9e76-115">Dans le cas le plus simple, vous écrivez uniquement aux membres d’un objet de collection, et non à la lecture de leurs propriétés.</span><span class="sxs-lookup"><span data-stu-id="d9e76-115">In the simplest case, you are only writing to members of a collection object, not reading their properties.</span></span> <span data-ttu-id="d9e76-116">Par exemple, le code suivant met en sur évidence en jaune chaque instance de « the » dans un document Word.</span><span class="sxs-lookup"><span data-stu-id="d9e76-116">For example, the following code highlights in yellow every instance of "the" in a Word document.</span></span>

> [!NOTE]
> <span data-ttu-id="d9e76-117">Il est généralement pratique de placer une finale juste avant le caractère de fermeture « } » de la méthode `context.sync` d’application `run` (par `Excel.run` exemple, `Word.run` , etc.).</span><span class="sxs-lookup"><span data-stu-id="d9e76-117">It is generally a good practice to put have a final `context.sync` just before the closing "}" character of the application `run` method (such as `Excel.run`, `Word.run`, etc.).</span></span> <span data-ttu-id="d9e76-118">Cela est dû au fait que la méthode effectue un appel masqué en tant que dernière chose qu’elle fait si, et uniquement si, il existe des commandes en file d’attente qui n’ont pas encore `run` `context.sync` été synchronisées.</span><span class="sxs-lookup"><span data-stu-id="d9e76-118">This is because the `run` method makes a hidden call of `context.sync` as the last thing it does if, and only if, there are queued commands that have not yet been synchronized.</span></span> <span data-ttu-id="d9e76-119">Le fait que cet appel soit masqué peut prêter à confusion, c’est pourquoi nous vous recommandons généralement d’ajouter l’appel `context.sync` explicite.</span><span class="sxs-lookup"><span data-stu-id="d9e76-119">The fact that this call is hidden can be confusing, so we generally recommend that you add the explicit `context.sync`.</span></span> <span data-ttu-id="d9e76-120">Toutefois, étant donné que cet article est sur la réduction des appels de , il est en fait plus déroutant d’ajouter une finale entièrement `context.sync` inutile `context.sync` .</span><span class="sxs-lookup"><span data-stu-id="d9e76-120">However, given that this article is about minimizing calls of `context.sync`, it is actually more confusing to add an entirely unnecessary final `context.sync`.</span></span> <span data-ttu-id="d9e76-121">Ainsi, dans cet article, nous ne le faisons pas lorsqu’il n’y a aucune commande nonynchronisée à la fin du `run` .</span><span class="sxs-lookup"><span data-stu-id="d9e76-121">So, in this article, we leave it out when there are no unsynchronized commands at the end of the `run`.</span></span>

```javascript
Word.run(async function (context) {
    let startTime, endTime;
    const docBody = context.document.body;

    // search() returns an array of Ranges.
    const searchResults = docBody.search('the', { matchWholeWord: true });
    context.load(searchResults, 'items');
    await context.sync();

    // Record the system time.
    startTime = performance.now();

    for (var i = 0; i < searchResults.items.length; i++) {
      searchResults.items[i].font.highlightColor = '#FFFF00';

      await context.sync(); // SYNCHRONIZE IN EACH ITERATION
    }
    
    // await context.sync(); // SYNCHRONIZE AFTER THE LOOP

    // Record the system time again then calculate how long the operation took.
    endTime = performance.now();
    console.log("The operation took: " + (endTime - startTime) + " milliseconds.");
  })
}
```

<span data-ttu-id="d9e76-122">Le code précédent a pris 1 seconde complète pour se terminer dans un document avec 200 instances de « the » dans Word Windows.</span><span class="sxs-lookup"><span data-stu-id="d9e76-122">The preceding code took 1 full second to complete in a document with 200 instances of "the" in Word on Windows.</span></span> <span data-ttu-id="d9e76-123">Toutefois, lorsque la ligne à l’intérieur de la boucle est commentée et que la même ligne est décompressée, l’opération n’a pris qu’un `await context.sync();` 1/10e de seconde.</span><span class="sxs-lookup"><span data-stu-id="d9e76-123">But when the `await context.sync();` line inside the loop is commented out and the same line just after the loop is uncommented, the operation took only a 1/10th of a second.</span></span> <span data-ttu-id="d9e76-124">Dans Word sur le web (avec Edge comme navigateur), la synchronisation à l’intérieur de la boucle prenait 3 secondes et seulement 6/10 secondes avec la synchronisation après la boucle, environ cinq fois plus rapide.</span><span class="sxs-lookup"><span data-stu-id="d9e76-124">In Word on the web (with Edge as the browser), it took 3 full seconds with the synchronization inside the loop and only 6/10ths of a second with the synchronization after the loop, about five times faster.</span></span> <span data-ttu-id="d9e76-125">Dans un document avec 2 000 instances de « the », il a fallu (en Word sur le web) 80 secondes avec la synchronisation à l’intérieur de la boucle et seulement 4 secondes avec la synchronisation après la boucle, environ 20 fois plus rapide.</span><span class="sxs-lookup"><span data-stu-id="d9e76-125">In a document with 2000 instances of "the", it took (in Word on the web) 80 seconds with the synchronization inside the loop and only 4 seconds with the synchronization after the loop, about 20 times faster.</span></span>

> [!NOTE]
> <span data-ttu-id="d9e76-126">Il est intéressant de vous demander si la version synchronisée à l’intérieur de la boucle s’exécuterait plus rapidement si les synchronisations s’exécutaient simultanément, ce qui pourrait être fait en supprimant simplement le mot clé à l’avant de la `await` `context.sync()` boucle.</span><span class="sxs-lookup"><span data-stu-id="d9e76-126">It's worth asking whether the synchronize-inside-the-loop version would execute faster if the synchronizations ran concurrently, which could be done by simply removing the `await` keyword from the front of the `context.sync()`.</span></span> <span data-ttu-id="d9e76-127">Cela entraînerait le démarrage de la synchronisation par le runtime, puis le démarrage immédiat de l’itération suivante de la boucle sans attendre la fin de la synchronisation.</span><span class="sxs-lookup"><span data-stu-id="d9e76-127">This would cause the runtime to initiate the synchronization and then immediately start the next iteration of the loop without waiting for the synchronization to complete.</span></span> <span data-ttu-id="d9e76-128">Toutefois, il ne s’agit pas d’une solution aussi adaptée que de sortir complètement de la boucle `context.sync` pour les raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="d9e76-128">However, this is not as good a solution as moving the `context.sync` out of the loop entirely for these reasons:</span></span>
>
> - <span data-ttu-id="d9e76-129">Tout comme les commandes d’un travail de lot de synchronisation sont en file d’attente, les travaux de lots eux-mêmes sont mis en file d’attente dans Office, mais Office ne prend pas en charge plus de 50 travaux par lots dans la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="d9e76-129">Just as the commands in a synchronization batch job are queued, the batch jobs themselves are queued in Office, but Office supports no more than 50 batch jobs in the queue.</span></span> <span data-ttu-id="d9e76-130">Toute autre erreur se déclenche.</span><span class="sxs-lookup"><span data-stu-id="d9e76-130">Any more triggers errors.</span></span> <span data-ttu-id="d9e76-131">Ainsi, s’il y a plus de 50 itérations dans une boucle, il est possible que la taille de la file d’attente soit dépassée.</span><span class="sxs-lookup"><span data-stu-id="d9e76-131">So, if there are more than 50 iterations in a loop, there is a chance that the queue size is exceeded.</span></span> <span data-ttu-id="d9e76-132">Plus le nombre d’itérations est élevé, plus le risque est grand.</span><span class="sxs-lookup"><span data-stu-id="d9e76-132">The greater the number of iterations, the greater the chance of this happening.</span></span> 
> - <span data-ttu-id="d9e76-133">« Simultanément » ne signifie pas simultanément.</span><span class="sxs-lookup"><span data-stu-id="d9e76-133">"Concurrently" does not mean simultaneously.</span></span> <span data-ttu-id="d9e76-134">L’exécution de plusieurs opérations de synchronisation peut encore prendre plus de temps que d’en exécuter une.</span><span class="sxs-lookup"><span data-stu-id="d9e76-134">It would still take longer to execute multiple synchronization operations than to execute one.</span></span>
> - <span data-ttu-id="d9e76-135">Il n’est pas garanti que les opérations simultanées se terminent dans l’ordre dans lequel elles ont démarré.</span><span class="sxs-lookup"><span data-stu-id="d9e76-135">Concurrent operations are not guaranteed to complete in the same order in which they started.</span></span> <span data-ttu-id="d9e76-136">Dans l’exemple précédent, peu importe l’ordre dans lequel le mot « the » est mis en surbrillant, mais dans certains cas, il est important que les éléments de la collection soient traitées dans l’ordre.</span><span class="sxs-lookup"><span data-stu-id="d9e76-136">In the preceding example, it doesn't matter what order the  word "the" gets highlighted, but there are scenarios where it's important that the items in the collection be processed in order.</span></span>

## <a name="reading-values-from-the-document-with-the-split-loop-pattern"></a><span data-ttu-id="d9e76-137">Lecture des valeurs du document avec le modèle de boucle fractionner</span><span class="sxs-lookup"><span data-stu-id="d9e76-137">Reading values from the document with the split loop pattern</span></span>

<span data-ttu-id="d9e76-138">L’évitement de s’y trouver dans une boucle devient plus difficile lorsque le code doit lire une propriété des éléments de `context.sync` la collection lorsqu’il traite chacun d’eux. </span><span class="sxs-lookup"><span data-stu-id="d9e76-138">Avoiding `context.sync`s inside a loop becomes more challenging when the code must *read* a property of the collection items as it processes each one.</span></span> <span data-ttu-id="d9e76-139">Supposons que votre code doit itérer tous les contrôles de contenu dans un document Word et consigner le texte du premier paragraphe associé à chaque contrôle.</span><span class="sxs-lookup"><span data-stu-id="d9e76-139">Suppose your code needs to iterate all the content controls in a Word document and log the text of the first paragraph associated with each control.</span></span> <span data-ttu-id="d9e76-140">Vos programmes peuvent vous amener à faire une boucle sur les contrôles, à charger la propriété de chaque (premier) paragraphe, à appeler pour remplir l’objet de paragraphe proxy avec le texte du document, puis à le `text` `context.sync` journaliser.</span><span class="sxs-lookup"><span data-stu-id="d9e76-140">Your programming instincts might lead you to loop over the controls, load the `text` property of each (first) paragraph, call `context.sync` to populate the proxy paragraph object with the text from the document, and then log it.</span></span> <span data-ttu-id="d9e76-141">Voici un exemple.</span><span class="sxs-lookup"><span data-stu-id="d9e76-141">The following is an example.</span></span>

```javascript
Word.run(async (context) => {
    const contentControls = context.document.contentControls.load('items');
    await context.sync();

    for (let i = 0; i < contentControls.items.length; i++) {
      const paragraph = contentControls.items[i].getRange('Whole').paragraphs.getFirst();
      paragraph.load('text');
      await context.sync();
      console.log(paragraph.text);
    }
});
```

<span data-ttu-id="d9e76-142">Dans ce scénario, pour éviter d’avoir une boucle en boucle, vous devez utiliser un modèle que `context.sync` nous appelons le **modèle de boucle fractionner.**</span><span class="sxs-lookup"><span data-stu-id="d9e76-142">In this scenario, to avoid having a `context.sync` in a loop, you should use a pattern we call the **split loop** pattern.</span></span> <span data-ttu-id="d9e76-143">Voyons un exemple concret du modèle avant d’en obtenir une description formelle.</span><span class="sxs-lookup"><span data-stu-id="d9e76-143">Let's see a concrete example of the pattern before we get to a formal description of it.</span></span> <span data-ttu-id="d9e76-144">Voici comment le modèle de boucle fractionner peut être appliqué à l’extrait de code précédent.</span><span class="sxs-lookup"><span data-stu-id="d9e76-144">Here's how the split loop pattern can be applied to the preceding code snippet.</span></span> <span data-ttu-id="d9e76-145">Notez les points suivants concernant ce code.</span><span class="sxs-lookup"><span data-stu-id="d9e76-145">Note the following about this code.</span></span>

- <span data-ttu-id="d9e76-146">Il existe maintenant deux boucles qui `context.sync` s’entrent entre elles, il n’y a donc aucune boucle `context.sync` à l’intérieur de l’une ou l’autre.</span><span class="sxs-lookup"><span data-stu-id="d9e76-146">There are now two loops and the `context.sync` comes between them, so there's no `context.sync` inside either loop.</span></span>
- <span data-ttu-id="d9e76-147">La première boucle par itérera les éléments de l’objet de collection et charge la propriété comme la boucle d’origine, mais la première boucle ne peut pas journaliser le texte du paragraphe, car elle ne contient plus de valeur pour remplir la propriété de l’objet `text` `context.sync` `text` `paragraph` proxy.</span><span class="sxs-lookup"><span data-stu-id="d9e76-147">The first loop iterates through the items in the collection object and loads the `text` property just as the original loop did, but the first loop cannot log the paragraph text because it no longer contains a `context.sync` to populate the `text` property of the `paragraph` proxy object.</span></span> <span data-ttu-id="d9e76-148">Au lieu de cela, il ajoute `paragraph` l’objet à un tableau.</span><span class="sxs-lookup"><span data-stu-id="d9e76-148">Instead, it adds the `paragraph` object to an array.</span></span>
- <span data-ttu-id="d9e76-149">La seconde boucle par itérera dans le tableau créé par la première boucle et enregistre le `text` journal de chaque `paragraph` élément.</span><span class="sxs-lookup"><span data-stu-id="d9e76-149">The second loop iterates through the array that was created by the first loop, and logs the `text` of each `paragraph` item.</span></span> <span data-ttu-id="d9e76-150">Cela est possible car la boucle entre les `context.sync` deux boucles remplit toutes les `text` propriétés.</span><span class="sxs-lookup"><span data-stu-id="d9e76-150">This is possible because the `context.sync` that came between the two loops populated all the `text` properties.</span></span>

```javascript
Word.run(async (context) => {
    const contentControls = context.document.contentControls.load("items");
    await context.sync();

    const firstParagraphsOfCCs = [];
    for (let i = 0; i < contentControls.items.length; i++) {
      const paragraph = contentControls.items[i].getRange('Whole').paragraphs.getFirst();
      paragraph.load('text');
      firstParagraphsOfCCs.push(paragraph);
    }

    await context.sync();

    for (let i = 0; i < firstParagraphsOfCCs.length; i++) {
      console.log(firstParagraphsOfCCs[i].text);
    }
});
```

<span data-ttu-id="d9e76-151">L’exemple précédent suggère la procédure suivante pour transformer une boucle qui contient une boucle en `context.sync` modèle de boucle fractionner.</span><span class="sxs-lookup"><span data-stu-id="d9e76-151">The preceding example suggests the following procedure for turning a loop that contains a `context.sync` into the split loop pattern.</span></span>

1. <span data-ttu-id="d9e76-152">Remplacez la boucle par deux boucles.</span><span class="sxs-lookup"><span data-stu-id="d9e76-152">Replace the loop with two loops.</span></span>
2. <span data-ttu-id="d9e76-153">Créez une première boucle pour itérer sur la collection et ajoutez chaque élément à un tableau tout en chargeant n’importe quelle propriété de l’élément que votre code doit lire.</span><span class="sxs-lookup"><span data-stu-id="d9e76-153">Create a first loop to iterate over the collection and add each item to an array while also loading any property of the item that your code needs to read.</span></span>
3. <span data-ttu-id="d9e76-154">Après la première boucle, appelez `context.sync` pour remplir les objets proxy avec les propriétés chargées.</span><span class="sxs-lookup"><span data-stu-id="d9e76-154">Following the first loop, call `context.sync` to populate the proxy objects with any loaded properties.</span></span>
4. <span data-ttu-id="d9e76-155">Suivez la deuxième boucle pour itérer sur le tableau créé dans la première boucle et `context.sync` lire les propriétés chargées.</span><span class="sxs-lookup"><span data-stu-id="d9e76-155">Follow the `context.sync` with a second loop to iterate over the array created in the first loop and read the loaded properties.</span></span>

## <a name="processing-objects-in-the-document-with-the-correlated-objects-pattern"></a><span data-ttu-id="d9e76-156">Traitement d’objets dans le document avec le modèle d’objets corrélés</span><span class="sxs-lookup"><span data-stu-id="d9e76-156">Processing objects in the document with the correlated objects pattern</span></span>

<span data-ttu-id="d9e76-157">Considérons un scénario plus complexe dans lequel le traitement des éléments de la collection nécessite des données qui ne se trouvent pas dans les éléments eux-mêmes.</span><span class="sxs-lookup"><span data-stu-id="d9e76-157">Let's consider a more complex scenario where processing the items in the collection requires data that isn't in the items themselves.</span></span> <span data-ttu-id="d9e76-158">Le scénario envisage un add-in Word qui fonctionne sur des documents créés à partir d’un modèle avec du texte réutilisable.</span><span class="sxs-lookup"><span data-stu-id="d9e76-158">The scenario envisions a Word add-in that operates on documents created from a template with some boilerplate text.</span></span> <span data-ttu-id="d9e76-159">Une ou plusieurs instances des chaînes d’espaces réservé suivantes sont dispersées dans le texte : « {Coordinator} », « {Coordinator} » et « {Manager} ».</span><span class="sxs-lookup"><span data-stu-id="d9e76-159">Scattered in the text are one or more instances of the following placeholder strings: "{Coordinator}", "{Deputy}", and "{Manager}".</span></span> <span data-ttu-id="d9e76-160">Le add-in remplace chaque espace réservé par le nom d’une personne.</span><span class="sxs-lookup"><span data-stu-id="d9e76-160">The add-in replaces each placeholder with some person's name.</span></span> <span data-ttu-id="d9e76-161">L’interface utilisateur du add-in n’est pas importante pour cet article.</span><span class="sxs-lookup"><span data-stu-id="d9e76-161">The UI of the add-in is not important to this article.</span></span> <span data-ttu-id="d9e76-162">Par exemple, il peut avoir un volet Des tâches avec trois zones de texte, chacune étiquetée avec l’un des espaces réservé.</span><span class="sxs-lookup"><span data-stu-id="d9e76-162">For example, it could have a task pane with three text boxes, each labeled with one of the placeholders.</span></span> <span data-ttu-id="d9e76-163">L’utilisateur entre un nom dans chaque zone de texte, puis appuie sur un **bouton** Remplacer.</span><span class="sxs-lookup"><span data-stu-id="d9e76-163">The user enters a name in each text box and then presses a **Replace** button.</span></span> <span data-ttu-id="d9e76-164">Le responsable du bouton crée un tableau qui met les noms sur les espaces réservé, puis remplace chaque espace réservé par le nom attribué.</span><span class="sxs-lookup"><span data-stu-id="d9e76-164">The handler for the button creates an array that maps the names to the placeholders, and then replaces each placeholder with the assigned name.</span></span> 

<span data-ttu-id="d9e76-165">Vous n’avez pas besoin de produire réellement un add-in avec cette interface utilisateur pour expérimenter le code.</span><span class="sxs-lookup"><span data-stu-id="d9e76-165">You don't need to actually produce an add-in with this UI to experiment with the code.</span></span> <span data-ttu-id="d9e76-166">Vous pouvez utiliser [l’outil Script Lab pour](../overview/explore-with-script-lab.md) prototyper le code important.</span><span class="sxs-lookup"><span data-stu-id="d9e76-166">You can use the [Script Lab tool](../overview/explore-with-script-lab.md) to prototype the important code.</span></span> <span data-ttu-id="d9e76-167">Utilisez l’instruction d’affectation suivante pour créer le tableau de mappage.</span><span class="sxs-lookup"><span data-stu-id="d9e76-167">Use the following assignment statement to create the mapping array.</span></span>

```javascript
const jobMapping = [
        { job: "{Coordinator}", person: "Sally" },
        { job: "{Deputy}", person: "Bob" },
        { job: "{Manager}", person: "Kim" }
    ];
```

<span data-ttu-id="d9e76-168">Le code suivant montre comment vous pouvez remplacer chaque espace réservé par son nom attribué si vous avez utilisé `context.sync` des boucles intérieures.</span><span class="sxs-lookup"><span data-stu-id="d9e76-168">The following code shows how you might replace each placeholder with its assigned name if you used `context.sync` inside loops.</span></span>

```javascript
Word.run(async (context) => {

    for (let i = 0; i < jobMapping.length; i++) {
      let options = Word.SearchOptions.newObject(context);
      options.matchWildCards = false;
      let searchResults = context.document.body.search(jobMapping[i].job, options);
      searchResults.load('items');

      await context.sync(); 

      for (let j = 0; j < searchResults.items.length; j++) {
        searchResults.items[j].insertText(jobMapping[i].person, Word.InsertLocation.replace);

        await context.sync();
      }
    }
});
```

<span data-ttu-id="d9e76-169">Dans le code précédent, il existe une boucle externe et une boucle interne.</span><span class="sxs-lookup"><span data-stu-id="d9e76-169">In the preceding code, there is an outer and an inner loop.</span></span> <span data-ttu-id="d9e76-170">Chacun d’eux contient un `context.sync` .</span><span class="sxs-lookup"><span data-stu-id="d9e76-170">Each of them contains a `context.sync`.</span></span> <span data-ttu-id="d9e76-171">Selon le tout premier extrait de code de cet article, vous verrez probablement que la boucle interne peut simplement être déplacée après la `context.sync` boucle interne.</span><span class="sxs-lookup"><span data-stu-id="d9e76-171">Based on the very first code snippet in this article, you probably see that the `context.sync` in the inner loop can simply be moved after the inner loop.</span></span> <span data-ttu-id="d9e76-172">Toutefois, cela laisserait le code `context.sync` avec un (deux d’entre eux en fait) dans la boucle externe.</span><span class="sxs-lookup"><span data-stu-id="d9e76-172">But that would still leave the code with a `context.sync` (two of them actually) in the outer loop.</span></span> <span data-ttu-id="d9e76-173">Le code suivant montre comment supprimer `context.sync` des boucles.</span><span class="sxs-lookup"><span data-stu-id="d9e76-173">The following code shows how you can remove `context.sync` from the loops.</span></span> <span data-ttu-id="d9e76-174">Nous abordons le code ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="d9e76-174">We discuss the code below.</span></span>

```javascript
Word.run(async (context) => {

    const allSearchResults = [];
    for (let i = 0; i < jobMapping.length; i++) {
      let options = Word.SearchOptions.newObject(context);
      options.matchWildCards = false;
      let searchResults = context.document.body.search(jobMapping[i].job, options);
      searchResults.load('items');
      let correlatedSearchResult = {
        rangesMatchingJob: searchResults,
        personAssignedToJob: jobMapping[i].person
      }
      allSearchResults.push(correlatedSearchResult);
    }

    await context.sync()

    for (let i = 0; i < allSearchResults.length; i++) {
      let correlatedObject = allSearchResults[i];

      for (let j = 0; j < correlatedObject.rangesMatchingJob.items.length; j++) {
        let targetRange = correlatedObject.rangesMatchingJob.items[j];
        let name = correlatedObject.personAssignedToJob;
        targetRange.insertText(name, Word.InsertLocation.replace);
      }
    }

    await context.sync();
});
```

<span data-ttu-id="d9e76-175">Notez que le code utilise le modèle de boucle fractionner :</span><span class="sxs-lookup"><span data-stu-id="d9e76-175">Note the code uses the split loop pattern:</span></span>

- <span data-ttu-id="d9e76-176">La boucle externe de l’exemple précédent a été divisée en deux.</span><span class="sxs-lookup"><span data-stu-id="d9e76-176">The outer loop from the preceding example has been split into two.</span></span> <span data-ttu-id="d9e76-177">(La deuxième boucle possède une boucle interne, ce qui est attendu car le code se itère sur un ensemble de travaux (ou espaces réservé) et dans ce jeu, il itère sur les plages correspondantes.)</span><span class="sxs-lookup"><span data-stu-id="d9e76-177">(The second loop has an inner loop, which is expected because the code is iterating over a set of jobs (or placeholders) and within that set it is iterating over the matching ranges.)</span></span>
- <span data-ttu-id="d9e76-178">Il existe une `context.sync` boucle après chaque boucle principale, mais pas à `context.sync` l’intérieur d’une boucle.</span><span class="sxs-lookup"><span data-stu-id="d9e76-178">There is a `context.sync` after each major loop, but no `context.sync` inside any loop.</span></span>
- <span data-ttu-id="d9e76-179">La deuxième boucle principale par itérera dans un tableau créé dans la première boucle.</span><span class="sxs-lookup"><span data-stu-id="d9e76-179">The second major loop iterates through an array that is created in the first loop.</span></span>

<span data-ttu-id="d9e76-180">Toutefois, le tableau créé  dans la première boucle ne contient pas seulement un objet Office comme la première boucle l’a fait dans la section Valeurs de lecture du document avec le modèle de boucle [fractionner](#reading-values-from-the-document-with-the-split-loop-pattern).</span><span class="sxs-lookup"><span data-stu-id="d9e76-180">But the array created in the first loop does *not* contain only an Office object as the first loop did in the section [Reading values from the document with the split loop pattern](#reading-values-from-the-document-with-the-split-loop-pattern).</span></span> <span data-ttu-id="d9e76-181">Cela est dû au fait que certaines des informations nécessaires au traitement des objets de plage word ne se trouvent pas dans les objets Range eux-mêmes, mais proviennent plutôt du `jobMapping` tableau.</span><span class="sxs-lookup"><span data-stu-id="d9e76-181">This is because some of the information needed to process the Word Range objects is not in the Range objects themselves but instead comes from the `jobMapping` array.</span></span>

<span data-ttu-id="d9e76-182">Ainsi, les objets du tableau créé dans la première boucle sont des objets personnalisés qui ont deux propriétés.</span><span class="sxs-lookup"><span data-stu-id="d9e76-182">So, the objects in the array created in the first loop are custom objects that have two properties.</span></span> <span data-ttu-id="d9e76-183">La première est un tableau de plages de mots qui correspondent à une fonction spécifique (c’est-à-dire, une chaîne d’espace réservé) et la seconde est une chaîne qui fournit le nom de la personne affectée au travail.</span><span class="sxs-lookup"><span data-stu-id="d9e76-183">The first is an array of Word Ranges that match a specific job title (that is, a placeholder string) and the second is a string that provides the name of the person assigned to the job.</span></span> <span data-ttu-id="d9e76-184">Cela facilite l’écriture et la lecture de la boucle finale, car toutes les informations nécessaires au traitement d’une plage donnée sont contenues dans le même objet personnalisé qui contient la plage.</span><span class="sxs-lookup"><span data-stu-id="d9e76-184">This makes the final loop easy to write and easy to read because all of the information needed to process a given range is contained in the same custom object that contains the range.</span></span> <span data-ttu-id="d9e76-185">Le nom qui doit remplacer _**correlatedObject**.rangesMatchingJob.items[j]_ est l’autre propriété du même objet : _**correlatedObject**.personAssignedToJob_.</span><span class="sxs-lookup"><span data-stu-id="d9e76-185">The name that should replace _**correlatedObject**.rangesMatchingJob.items[j]_ is the other property of the same object: _**correlatedObject**.personAssignedToJob_.</span></span>

<span data-ttu-id="d9e76-186">Nous appelons cette variante du modèle de boucle fractionée le **modèle d’objets corrélés.**</span><span class="sxs-lookup"><span data-stu-id="d9e76-186">We call this variation of the split loop pattern the **correlated objects** pattern.</span></span> <span data-ttu-id="d9e76-187">L’idée générale est que la première boucle crée un tableau d’objets personnalisés.</span><span class="sxs-lookup"><span data-stu-id="d9e76-187">The general idea is that the first loop creates an array of custom objects.</span></span> <span data-ttu-id="d9e76-188">Chaque objet possède une propriété dont la valeur est l’un des éléments d’un Office collection d’objets (ou d’un tableau de ces éléments).</span><span class="sxs-lookup"><span data-stu-id="d9e76-188">Each object has a property whose value is one of the items in an Office collection object (or an array of such items).</span></span> <span data-ttu-id="d9e76-189">L’objet personnalisé possède d’autres propriétés, chacune d’elles fournit les informations nécessaires pour traiter les Office dans la boucle finale.</span><span class="sxs-lookup"><span data-stu-id="d9e76-189">The custom object has other properties, each of which provides information needed to process the Office objects in the final loop.</span></span> <span data-ttu-id="d9e76-190">Consultez la section Autres exemples de [ces modèles](#other-examples-of-these-patterns) pour obtenir un lien vers un exemple où l’objet de corrélation personnalisé possède plus de deux propriétés.</span><span class="sxs-lookup"><span data-stu-id="d9e76-190">See the section [Other examples of these patterns](#other-examples-of-these-patterns) for a link to an example where the custom correlating object has more than two properties.</span></span>

<span data-ttu-id="d9e76-191">Autre mise en garde : il faut parfois plusieurs boucles simplement pour créer le tableau d’objets de mise en corrélation personnalisés.</span><span class="sxs-lookup"><span data-stu-id="d9e76-191">One further caveat: sometimes it takes more than one loop just to create the array of custom correlating objects.</span></span> <span data-ttu-id="d9e76-192">Cela peut se produire si vous devez lire une propriété de chaque membre d’un objet de collection Office uniquement pour collecter des informations qui seront utilisées pour traiter un autre objet de collection.</span><span class="sxs-lookup"><span data-stu-id="d9e76-192">This can happen if you need to read a property of each member of one Office collection object just to gather information that will be used to process another collection object.</span></span> <span data-ttu-id="d9e76-193">(Par exemple, votre code doit lire les titres de toutes les colonnes d’un tableau Excel, car votre application va appliquer un format numérique aux cellules de certaines colonnes en fonction du titre de cette colonne.) Mais vous pouvez toujours conserver les `context.sync` s entre les boucles, plutôt que dans une boucle.</span><span class="sxs-lookup"><span data-stu-id="d9e76-193">(For example, your code needs to read the titles of all the columns in an Excel table because your add-in is going to apply a number format to the cells of some columns based on that column's title.) But you can always keep the `context.sync`s between the loops, rather than in a loop.</span></span> <span data-ttu-id="d9e76-194">Consultez la section [Autres exemples de ces modèles](#other-examples-of-these-patterns) pour obtenir un exemple.</span><span class="sxs-lookup"><span data-stu-id="d9e76-194">See the section [Other examples of these patterns](#other-examples-of-these-patterns) for an example.</span></span>

## <a name="other-examples-of-these-patterns"></a><span data-ttu-id="d9e76-195">Autres exemples de ces modèles</span><span class="sxs-lookup"><span data-stu-id="d9e76-195">Other examples of these patterns</span></span>

- <span data-ttu-id="d9e76-196">Pour obtenir un exemple très simple de Excel qui utilise des boucles, consultez la réponse acceptée à cette question stack overflow : est-il possible de mettre en file d’attente plusieurs `Array.forEach` [context.load avant context.sync ?](https://stackoverflow.com/questions/44459604/is-it-possible-to-queue-more-than-one-context-load-before-context-sync)</span><span class="sxs-lookup"><span data-stu-id="d9e76-196">For a very simple example for Excel that uses `Array.forEach` loops, see the accepted answer to this Stack Overflow question: [Is it possible to queue more than one context.load before context.sync?](https://stackoverflow.com/questions/44459604/is-it-possible-to-queue-more-than-one-context-load-before-context-sync)</span></span>
- <span data-ttu-id="d9e76-197">Pour obtenir un exemple simple pour Word qui utilise des boucles et n’utilise pas de `Array.forEach` `async` / `await` syntaxe, [](https://stackoverflow.com/questions/58422113/iterating-over-all-paragraphs-with-content-controls-with-office-javascript-api)voir la réponse acceptée à cette question stack overflow : Itérant sur tous les paragraphes avec des contrôles de contenu avec Office API JavaScript .</span><span class="sxs-lookup"><span data-stu-id="d9e76-197">For a simple example for Word that uses `Array.forEach` loops and doesn't use `async`/`await` syntax, see the accepted answer to this Stack Overflow question: [Iterating over all paragraphs with content controls with Office JavaScript API](https://stackoverflow.com/questions/58422113/iterating-over-all-paragraphs-with-content-controls-with-office-javascript-api).</span></span>
- <span data-ttu-id="d9e76-198">Pour obtenir un exemple pour Word écrit en TypeScript, voir l’exemple de contrôle de style du [add-in Word Angular2,](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker)en particulier le fichier [word.document.service.ts](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker/blob/master/app/services/word-document/word.document.service.ts).</span><span class="sxs-lookup"><span data-stu-id="d9e76-198">For an example for Word that is written in TypeScript, see the sample [Word Add-in Angular2 Style Checker](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker), especially the file [word.document.service.ts](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker/blob/master/app/services/word-document/word.document.service.ts).</span></span> <span data-ttu-id="d9e76-199">Il possède une combinaison de `for` `Array.forEach` boucles et de boucles.</span><span class="sxs-lookup"><span data-stu-id="d9e76-199">It has a mixture of `for` and `Array.forEach` loops.</span></span>
- <span data-ttu-id="d9e76-200">Pour obtenir un exemple Word avancé, [importez ce gist](https://gist.github.com/9c5a803e52480ec7f00bb3224292e0ab) dans [l’outil Script Lab.](../overview/explore-with-script-lab.md)</span><span class="sxs-lookup"><span data-stu-id="d9e76-200">For an advanced Word sample, import [this gist](https://gist.github.com/9c5a803e52480ec7f00bb3224292e0ab) into the [Script Lab tool](../overview/explore-with-script-lab.md).</span></span> <span data-ttu-id="d9e76-201">Pour plus de contexte dans l’utilisation du gist, voir la réponse acceptée à la question Stack Overflow [Document non synchronisé après le remplacement du texte](https://stackoverflow.com/questions/48227941/document-not-in-sync-after-replace-text).</span><span class="sxs-lookup"><span data-stu-id="d9e76-201">For context in using the gist, see the accepted answer to the Stack Overflow question [Document not in sync after replace text](https://stackoverflow.com/questions/48227941/document-not-in-sync-after-replace-text).</span></span> <span data-ttu-id="d9e76-202">Cet exemple crée un type d’objet de corrélation personnalisé qui possède trois propriétés.</span><span class="sxs-lookup"><span data-stu-id="d9e76-202">This sample creates a custom correlating object type that has three properties.</span></span> <span data-ttu-id="d9e76-203">Il utilise un total de trois boucles pour construire le tableau d’objets corrélés, et deux autres boucles pour réaliser le traitement final.</span><span class="sxs-lookup"><span data-stu-id="d9e76-203">It uses a total of three loops to construct the array of correlated objects, and two more loops to do the final processing.</span></span> <span data-ttu-id="d9e76-204">Il existe une combinaison de `for` `Array.forEach` boucles et de boucles.</span><span class="sxs-lookup"><span data-stu-id="d9e76-204">There are a mixture of `for` and `Array.forEach` loops.</span></span>
- <span data-ttu-id="d9e76-205">Bien qu’il ne s’agit pas strictement d’un exemple de boucle fractionner ou de modèles d’objets corrélés, il existe un exemple de Excel avancé qui montre comment convertir un ensemble de valeurs de cellule en d’autres devises avec une seule . `context.sync`</span><span class="sxs-lookup"><span data-stu-id="d9e76-205">Although not strictly an example of the split loop or correlated objects patterns, there is an advanced Excel sample that shows how to convert a set of cell values to other currencies with just a single `context.sync`.</span></span> <span data-ttu-id="d9e76-206">Pour l’essayer, ouvrez [Script Lab’outil et](../overview/explore-with-script-lab.md) accédez à l’exemple **de convertisseur de** devise.</span><span class="sxs-lookup"><span data-stu-id="d9e76-206">To try it, open the [Script Lab tool](../overview/explore-with-script-lab.md) and navigate to the **Currency Converter** sample.</span></span>

## <a name="when-should-you-not-use-the-patterns-in-this-article"></a><span data-ttu-id="d9e76-207">Quand ne *devez-vous* pas utiliser les modèles de cet article ?</span><span class="sxs-lookup"><span data-stu-id="d9e76-207">When should you *not* use the patterns in this article?</span></span>

<span data-ttu-id="d9e76-208">Excel ne peut pas lire plus de 5 Mo de données dans un appel donné de `context.sync` .</span><span class="sxs-lookup"><span data-stu-id="d9e76-208">Excel cannot read more than 5 MB of data in a given call of `context.sync`.</span></span> <span data-ttu-id="d9e76-209">Si cette limite est dépassée, une erreur est lancée.</span><span class="sxs-lookup"><span data-stu-id="d9e76-209">If this limit is exceeded, an error is thrown.</span></span> <span data-ttu-id="d9e76-210">(Pour plus d’informations, voir la section Excel sur les [limites](resource-limits-and-performance-optimization.md#excel-add-ins) de ressources et l’optimisation des performances pour les Office de recherche.) Il est très rare que cette limite soit approche, mais s’il est possible que cela  se produise avec votre add-in, votre code ne doit pas charger toutes les données en une seule boucle et suivre la boucle avec un `context.sync` .</span><span class="sxs-lookup"><span data-stu-id="d9e76-210">(See the "Excel add-ins section" of [Resource limits and performance optimization for Office Add-ins](resource-limits-and-performance-optimization.md#excel-add-ins) for more information.) It's very rare that this limit is approached, but if there's a chance that this will happen with your add-in, then your code should *not* load all the data in a single loop and follow the loop with a `context.sync`.</span></span> <span data-ttu-id="d9e76-211">Toutefois, évitez d’avoir une boucle dans chaque `context.sync` itération d’un objet de collection.</span><span class="sxs-lookup"><span data-stu-id="d9e76-211">But you still should avoid having a `context.sync` in every iteration of a loop over a collection object.</span></span> <span data-ttu-id="d9e76-212">Définissez plutôt les sous-ensembles des éléments de la collection et bouclez sur chaque sous-ensemble à son tour, avec un entre `context.sync` les boucles.</span><span class="sxs-lookup"><span data-stu-id="d9e76-212">Instead, define subsets of the items in the collection and loop over each subset in turn, with a `context.sync` between the loops.</span></span> <span data-ttu-id="d9e76-213">Vous pouvez structurer cela avec une boucle externe qui s’itération sur les sous-ensembles et contient les dans chacune de ces `context.sync` itérations extérieures.</span><span class="sxs-lookup"><span data-stu-id="d9e76-213">You could structure this with an outer loop that iterates over the subsets and contains the `context.sync` in each of these outer iterations.</span></span>
